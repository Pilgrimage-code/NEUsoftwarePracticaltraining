import{_ as B,c as N,e as q,b as s,A as a,p as l,z as d,a as w,r as U,o as z,$ as M,E as c,k as R,t as m,f as g}from"./index-Ntw4s37F.js";import{u as T}from"./user-Bcj8SPsV.js";const j={name:"UserProfile",setup(){const x=w("info"),e=w(!1),V=w(!1),o=w(null),I=w(null),i=U({}),v=w(null),P=U({meetingCount:0,courseCount:0,newsCount:0}),r=U({oldPassword:"",newPassword:"",confirmPassword:""}),u=U({twoFactorAuth:!1,loginNotification:!0}),_={nickname:[{required:!0,message:"请输入用户昵称",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},h={oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(t,k,y)=>{k!==r.newPassword?y(new Error("两次输入的密码不一致")):y()},trigger:"blur"}]},b="http://localhost:8080/api/upload/image",A={Authorization:"Bearer "+(localStorage.getItem("token")||"")},f=async t=>{t.code===200?(await T.updateUserAvatar(v.value,{avatar:t.data.url},{headers:{"X-Tenant-Id":i.tenantId}}),c.success("头像上传成功"),p()):c.error(t.message||"头像上传失败")},C=()=>{c.error("头像上传失败")},p=async()=>{const t=await M();t&&t.data&&(Object.assign(i,t.data),v.value=t.data.userId,i.gender=Number(i.gender??0))};z(p);const F=t=>{const k=t.type==="image/jpeg"||t.type==="image/png",y=t.size/1024/1024<2;return k||c.error("上传头像图片只能是 JPG/PNG 格式!"),y||c.error("上传头像图片大小不能超过 2MB!"),k&&y},S=async()=>{try{await o.value.validate(),e.value=!0;const t={username:i.username,nickname:i.nickname,phone:i.phone,email:i.email,gender:i.gender};await T.updateUser(v.value,t,{headers:{"X-Tenant-Id":i.tenantId}}),c.success("个人信息更新成功"),p()}catch(t){t!==!1&&c.error("更新失败")}finally{e.value=!1}},n=()=>{p(),c.info("已重置为原始数据")},E=async()=>{try{await I.value.validate(),V.value=!0,await T.changePassword(v.value,r.oldPassword,r.newPassword),c.success("密码修改成功"),L()}catch(t){t!==!1&&c.error("密码修改失败")}finally{V.value=!1}},L=()=>{var t;Object.assign(r,{oldPassword:"",newPassword:"",confirmPassword:""}),(t=I.value)==null||t.clearValidate()};return{activeTab:x,infoLoading:e,passwordLoading:V,infoFormRef:o,passwordFormRef:I,userInfo:i,userStats:P,passwordForm:r,securitySettings:u,infoFormRules:_,passwordFormRules:h,beforeAvatarUpload:F,uploadAction:b,uploadHeaders:A,handleAvatarSuccess:f,handleAvatarError:C,handleUpdateInfo:S,handleResetInfo:n,handleChangePassword:E,handleResetPassword:L,handleTwoFactorChange:t=>{c.success(t?"两步验证已开启":"两步验证已关闭")},handleLoginNotificationChange:t=>{c.success(t?"登录通知已开启":"登录通知已关闭")}}}},G={class:"profile"},H={class:"profile-container"},J={class:"profile-sidebar"},O={class:"profile-avatar-section"},X=["src"],D={key:1,class:"avatar-uploader-placeholder"},K={class:"profile-info"},Q={class:"profile-stats"},W={class:"stat-item"},Y={class:"stat-value"},Z={class:"stat-item"},$={class:"stat-value"},ee={class:"stat-item"},oe={class:"stat-value"},ae={class:"profile-content"},se={class:"security-settings"},le={class:"security-item"},te={class:"security-action"},ne={class:"security-item"},re={class:"security-info"},de={class:"security-action"},ie={class:"security-item"},ue={class:"security-info"},ce={class:"security-action"},fe={class:"security-item"},me={class:"security-action"},pe={class:"security-item"},_e={class:"security-action"};function ge(x,e,V,o,I,i){const v=d("el-upload"),P=d("el-card"),r=d("el-input"),u=d("el-form-item"),_=d("el-col"),h=d("el-row"),b=d("el-option"),A=d("el-select"),f=d("el-button"),C=d("el-form"),p=d("el-tab-pane"),F=d("el-switch"),S=d("el-tabs");return R(),N("div",G,[e[26]||(e[26]=q('<div class="page-header" data-v-9a6e64dd><div class="header-content" data-v-9a6e64dd><h1 class="page-title" data-v-9a6e64dd><i class="el-icon-user" data-v-9a6e64dd></i> 个人中心 </h1><p class="page-description" data-v-9a6e64dd>管理个人信息和账户设置</p></div></div>',1)),s("div",H,[s("div",J,[a(P,{class:"profile-card"},{default:l(()=>[s("div",O,[a(v,{class:"avatar-uploader",action:o.uploadAction,headers:o.uploadHeaders,"show-file-list":!1,"before-upload":o.beforeAvatarUpload,"on-success":o.handleAvatarSuccess,"on-error":o.handleAvatarError},{default:l(()=>[o.userInfo.avatar?(R(),N("img",{key:0,src:o.userInfo.avatar,class:"avatar"},null,8,X)):(R(),N("div",D,e[12]||(e[12]=[s("i",{class:"el-icon-plus avatar-uploader-icon"},null,-1),s("span",{style:{color:"#bbb","font-size":"12px"}},"点击上传",-1)])))]),_:1},8,["action","headers","before-upload","on-success","on-error"]),s("div",K,[s("h3",null,m(o.userInfo.username),1),s("p",null,m(o.userInfo.nickname),1)])]),s("div",Q,[s("div",W,[s("div",Y,m(o.userStats.meetingCount),1),e[13]||(e[13]=s("div",{class:"stat-label"},"参与会议",-1))]),s("div",Z,[s("div",$,m(o.userStats.courseCount),1),e[14]||(e[14]=s("div",{class:"stat-label"},"学习课程",-1))]),s("div",ee,[s("div",oe,m(o.userStats.newsCount),1),e[15]||(e[15]=s("div",{class:"stat-label"},"发布资讯",-1))])])]),_:1})]),s("div",ae,[a(P,{class:"content-card"},{default:l(()=>[a(S,{modelValue:o.activeTab,"onUpdate:modelValue":e[11]||(e[11]=n=>o.activeTab=n),type:"border-card"},{default:l(()=>[a(p,{label:"基本信息",name:"info"},{default:l(()=>[a(C,{ref:"infoFormRef",model:o.userInfo,rules:o.infoFormRules,"label-width":"100px",class:"info-form"},{default:l(()=>[a(h,{gutter:20},{default:l(()=>[a(_,{span:12},{default:l(()=>[a(u,{label:"用户名",prop:"username"},{default:l(()=>[a(r,{modelValue:o.userInfo.username,"onUpdate:modelValue":e[0]||(e[0]=n=>o.userInfo.username=n),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),a(_,{span:12},{default:l(()=>[a(u,{label:"用户昵称",prop:"nickname"},{default:l(()=>[a(r,{modelValue:o.userInfo.nickname,"onUpdate:modelValue":e[1]||(e[1]=n=>o.userInfo.nickname=n),placeholder:"请输入用户昵称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(h,{gutter:20},{default:l(()=>[a(_,{span:12},{default:l(()=>[a(u,{label:"手机号",prop:"phone"},{default:l(()=>[a(r,{modelValue:o.userInfo.phone,"onUpdate:modelValue":e[2]||(e[2]=n=>o.userInfo.phone=n),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})]),_:1}),a(_,{span:12},{default:l(()=>[a(u,{label:"邮箱",prop:"email"},{default:l(()=>[a(r,{modelValue:o.userInfo.email,"onUpdate:modelValue":e[3]||(e[3]=n=>o.userInfo.email=n),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(h,{gutter:20},{default:l(()=>[a(_,{span:12},{default:l(()=>[a(u,{label:"性别",prop:"gender"},{default:l(()=>[a(A,{modelValue:o.userInfo.gender,"onUpdate:modelValue":e[4]||(e[4]=n=>o.userInfo.gender=n),placeholder:"请选择性别",style:{width:"100%"}},{default:l(()=>[a(b,{label:"男",value:0}),a(b,{label:"女",value:1}),a(b,{label:"未知",value:2})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(u,null,{default:l(()=>[a(f,{type:"primary",onClick:o.handleUpdateInfo,loading:o.infoLoading},{default:l(()=>e[16]||(e[16]=[g(" 保存修改 ")])),_:1,__:[16]},8,["onClick","loading"]),a(f,{onClick:o.handleResetInfo},{default:l(()=>e[17]||(e[17]=[g("重置")])),_:1,__:[17]},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])]),_:1}),a(p,{label:"修改密码",name:"password"},{default:l(()=>[a(C,{ref:"passwordFormRef",model:o.passwordForm,rules:o.passwordFormRules,"label-width":"100px",class:"password-form"},{default:l(()=>[a(u,{label:"当前密码",prop:"oldPassword"},{default:l(()=>[a(r,{modelValue:o.passwordForm.oldPassword,"onUpdate:modelValue":e[5]||(e[5]=n=>o.passwordForm.oldPassword=n),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),a(u,{label:"新密码",prop:"newPassword"},{default:l(()=>[a(r,{modelValue:o.passwordForm.newPassword,"onUpdate:modelValue":e[6]||(e[6]=n=>o.passwordForm.newPassword=n),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),a(u,{label:"确认密码",prop:"confirmPassword"},{default:l(()=>[a(r,{modelValue:o.passwordForm.confirmPassword,"onUpdate:modelValue":e[7]||(e[7]=n=>o.passwordForm.confirmPassword=n),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),a(u,null,{default:l(()=>[a(f,{type:"primary",onClick:o.handleChangePassword,loading:o.passwordLoading},{default:l(()=>e[18]||(e[18]=[g(" 修改密码 ")])),_:1,__:[18]},8,["onClick","loading"]),a(f,{onClick:o.handleResetPassword},{default:l(()=>e[19]||(e[19]=[g("重置")])),_:1,__:[19]},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])]),_:1}),a(p,{label:"安全设置",name:"security"},{default:l(()=>[s("div",se,[s("div",le,[e[21]||(e[21]=s("div",{class:"security-info"},[s("h4",null,"登录密码"),s("p",null,"定期更换密码可以提高账户安全性")],-1)),s("div",te,[a(f,{type:"primary",onClick:e[8]||(e[8]=n=>o.activeTab="password")},{default:l(()=>e[20]||(e[20]=[g("修改密码")])),_:1,__:[20]})])]),s("div",ne,[s("div",re,[e[22]||(e[22]=s("h4",null,"手机绑定",-1)),s("p",null,"绑定手机号："+m(o.userInfo.phone||"未绑定"),1)]),s("div",de,[a(f,{type:"success"},{default:l(()=>[g(m(o.userInfo.phone?"更换手机":"绑定手机"),1)]),_:1})])]),s("div",ie,[s("div",ue,[e[23]||(e[23]=s("h4",null,"邮箱绑定",-1)),s("p",null,"绑定邮箱："+m(o.userInfo.email||"未绑定"),1)]),s("div",ce,[a(f,{type:"success"},{default:l(()=>[g(m(o.userInfo.email?"更换邮箱":"绑定邮箱"),1)]),_:1})])]),s("div",fe,[e[24]||(e[24]=s("div",{class:"security-info"},[s("h4",null,"两步验证"),s("p",null,"开启两步验证可以大大提高账户安全性")],-1)),s("div",me,[a(F,{modelValue:o.securitySettings.twoFactorAuth,"onUpdate:modelValue":e[9]||(e[9]=n=>o.securitySettings.twoFactorAuth=n),onChange:o.handleTwoFactorChange},null,8,["modelValue","onChange"])])]),s("div",pe,[e[25]||(e[25]=s("div",{class:"security-info"},[s("h4",null,"登录通知"),s("p",null,"有新设备登录时发送通知")],-1)),s("div",_e,[a(F,{modelValue:o.securitySettings.loginNotification,"onUpdate:modelValue":e[10]||(e[10]=n=>o.securitySettings.loginNotification=n),onChange:o.handleLoginNotificationChange},null,8,["modelValue","onChange"])])])])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])])}const ye=B(j,[["render",ge],["__scopeId","data-v-9a6e64dd"]]);export{ye as default};
