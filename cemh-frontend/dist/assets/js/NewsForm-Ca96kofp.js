import{_ as re,a as f,D as ue,G as de,r as ie,o as me,c as b,b as n,A as t,p as l,z as r,t as U,E as d,j as ce,k as i,f as m,m as _,C as N,F as R,d as L,Y as pe,N as _e}from"./index-Ntw4s37F.js";const ge={class:"news-form modern-page"},fe={class:"page-header"},ve={class:"header-content"},be={class:"header-left"},ye={class:"page-title"},we={class:"header-actions"},Ve={class:"form-container"},ke={class:"modern-card"},he={class:"card-body"},xe={class:"cover-upload"},Ie=["src"],Ce={key:1,class:"cover-placeholder"},Te={class:"modern-card"},De={class:"card-body"},Ue={class:"editor-container"},Ne={class:"editor-toolbar"},Re={class:"modern-card"},Le={class:"card-body"},Me={__name:"NewsForm",setup(qe){const M=de(),A=ce(),q=f(),Y=f(),x=f(!1),I=f(!1),w=f(""),V=ue(()=>!!M.params.id),k=f([]),h=f([]),a=ie({title:"",category:"",status:1,publishTime:"",summary:"",coverImage:"",content:"",tags:[],keywords:"",permission:"public",commentSettings:["allowComment"],tenantId:"",categoryId:""}),B=async()=>{try{const e=await(await fetch("http://localhost:8080/api/tenants/all")).json();e.code===200&&(k.value=e.data.map(u=>({value:u.id,label:u.tenantName})));const c=await(await fetch("http://localhost:8080/api/news-categories/all")).json();c.code===200&&(h.value=c.data.map(u=>({value:u.id,label:u.categoryName}))),console.log("企业列表",k.value),console.log("分类列表",h.value)}catch(s){console.error("加载数据失败:",s),d.error("加载数据失败")}},S={title:[{required:!0,message:"请输入资讯标题",trigger:"blur"},{min:5,max:100,message:"标题长度在 5 到 100 个字符",trigger:"blur"}],category:[{required:!0,message:"请选择资讯分类",trigger:"change"}],summary:[{required:!0,message:"请输入资讯摘要",trigger:"blur"},{max:200,message:"摘要不能超过 200 个字符",trigger:"blur"}],content:[{required:!0,message:"请输入资讯内容",trigger:"blur"},{min:50,message:"内容不能少于 50 个字符",trigger:"blur"}],publishTime:[{required:!0,message:"请选择发布时间",trigger:"change"}],tenantId:[{required:!0,message:"请选择所属企业",trigger:"change"}],categoryId:[{required:!0,message:"请选择资讯分类",trigger:"change"}]},F=async()=>{if(V.value)try{const s=M.params.id;Object.assign(a,{title:"公司2024年第一季度业绩报告",category:"company",status:1,summary:"本季度公司业绩表现优异，各项指标均超预期完成...",content:"<p>详细的业绩报告内容...</p>",tags:["业绩报告","第一季度"],keywords:"业绩,报告,第一季度",permission:"public",commentSettings:["allowComment","notifyAuthor"]})}catch{d.error("加载资讯数据失败")}},j=async()=>{try{await q.value.validate(),x.value=!0,await new Promise(s=>setTimeout(s,1e3)),d.success(V.value?"资讯更新成功":"资讯发布成功"),A.push("/dashboard/news")}catch(s){s!=="validation failed"&&d.error("提交失败，请重试")}finally{x.value=!1}},E=async()=>{try{a.status=0,d.success("草稿保存成功")}catch{d.error("保存草稿失败")}},G=s=>{const e=s.type.startsWith("image/"),g=s.size/1024/1024<2;return e?g?!0:(d.error("图片大小不能超过 2MB!"),!1):(d.error("只能上传图片文件!"),!1)},H=async s=>{const e=s.file,g=new FormData;g.append("file",e);try{const u=await(await fetch("http://localhost:8080/api/upload/image",{method:"POST",body:g})).json();u.code===200?(a.coverImage=u.data.url,d.success("图片上传成功")):d.error(u.message||"图片上传失败")}catch{d.error("图片上传失败")}},O=()=>{d.info("插入图片功能开发中")},$=()=>{d.info("插入链接功能开发中")},K=()=>{d.info("插入表格功能开发中")},J=s=>{const e=a.tags.indexOf(s);e>-1&&a.tags.splice(e,1)},W=()=>{I.value=!0,_e(()=>{var s;(s=Y.value)==null||s.focus()})},P=()=>{const s=w.value.trim();s&&!a.tags.includes(s)&&a.tags.push(s),I.value=!1,w.value=""};return me(()=>{B(),F()}),(s,e)=>{const g=r("ArrowLeft"),c=r("el-icon"),u=r("el-button"),y=r("el-input"),p=r("el-form-item"),v=r("el-option"),C=r("el-select"),T=r("el-radio"),Q=r("el-radio-group"),X=r("el-date-picker"),z=r("Plus"),Z=r("el-upload"),ee=r("Picture"),te=r("Link"),le=r("Grid"),oe=r("el-button-group"),ae=r("el-tag"),D=r("el-checkbox"),se=r("el-checkbox-group"),ne=r("el-form");return i(),b("div",ge,[n("div",fe,[n("div",ve,[n("div",be,[t(u,{type:"text",onClick:e[0]||(e[0]=o=>s.$router.go(-1)),class:"back-btn"},{default:l(()=>[t(c,null,{default:l(()=>[t(g)]),_:1}),e[12]||(e[12]=m(" 返回 "))]),_:1,__:[12]}),n("h1",ye,U(V.value?"编辑资讯":"发布资讯"),1)]),n("div",we,[t(u,{onClick:E,class:"modern-btn secondary"},{default:l(()=>e[13]||(e[13]=[m(" 保存草稿 ")])),_:1,__:[13]}),t(u,{type:"primary",onClick:j,loading:x.value,class:"modern-btn primary"},{default:l(()=>[m(U(V.value?"更新资讯":"发布资讯"),1)]),_:1},8,["loading"])])])]),n("div",Ve,[t(ne,{ref_key:"formRef",ref:q,model:a,rules:S,"label-width":"120px",class:"news-form-content"},{default:l(()=>[n("div",ke,[e[19]||(e[19]=n("div",{class:"card-header"},[n("h2",null,"基本信息")],-1)),n("div",he,[t(p,{label:"资讯标题",prop:"title"},{default:l(()=>[t(y,{modelValue:a.title,"onUpdate:modelValue":e[1]||(e[1]=o=>a.title=o),placeholder:"请输入资讯标题",maxlength:"100","show-word-limit":"",class:"modern-input"},null,8,["modelValue"])]),_:1}),k.value.length>0?(i(),_(C,{key:0,modelValue:a.tenantId,"onUpdate:modelValue":e[2]||(e[2]=o=>a.tenantId=o),placeholder:"请选择所属企业",class:"modern-select"},{default:l(()=>[(i(!0),b(R,null,L(k.value,o=>(i(),_(v,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):N("",!0),h.value.length>0?(i(),_(C,{key:1,modelValue:a.categoryId,"onUpdate:modelValue":e[3]||(e[3]=o=>a.categoryId=o),placeholder:"请选择资讯分类",class:"modern-select"},{default:l(()=>[(i(!0),b(R,null,L(h.value,o=>(i(),_(v,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):N("",!0),t(p,{label:"发布状态",prop:"status"},{default:l(()=>[t(Q,{modelValue:a.status,"onUpdate:modelValue":e[4]||(e[4]=o=>a.status=o)},{default:l(()=>[t(T,{label:0},{default:l(()=>e[14]||(e[14]=[m("草稿")])),_:1,__:[14]}),t(T,{label:1},{default:l(()=>e[15]||(e[15]=[m("立即发布")])),_:1,__:[15]}),t(T,{label:2},{default:l(()=>e[16]||(e[16]=[m("定时发布")])),_:1,__:[16]})]),_:1},8,["modelValue"])]),_:1}),a.status===2?(i(),_(p,{key:2,label:"发布时间",prop:"publishTime"},{default:l(()=>[t(X,{modelValue:a.publishTime,"onUpdate:modelValue":e[5]||(e[5]=o=>a.publishTime=o),type:"datetime",placeholder:"选择发布时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",class:"modern-input",style:{width:"100%"}},null,8,["modelValue"])]),_:1})):N("",!0),t(p,{label:"资讯摘要",prop:"summary"},{default:l(()=>[t(y,{modelValue:a.summary,"onUpdate:modelValue":e[6]||(e[6]=o=>a.summary=o),type:"textarea",rows:3,placeholder:"请输入资讯摘要，将显示在列表页",maxlength:"200","show-word-limit":"",class:"modern-input"},null,8,["modelValue"])]),_:1}),t(p,{label:"封面图片"},{default:l(()=>[n("div",xe,[t(Z,{class:"cover-uploader",action:"#","show-file-list":!1,"before-upload":G,"http-request":H},{default:l(()=>[a.coverImage?(i(),b("img",{key:0,src:a.coverImage,class:"cover-image"},null,8,Ie)):(i(),b("div",Ce,[t(c,{class:"cover-icon"},{default:l(()=>[t(z)]),_:1}),e[17]||(e[17]=n("div",{class:"cover-text"},"上传封面",-1))]))]),_:1}),e[18]||(e[18]=n("div",{class:"cover-tips"}," 建议尺寸：800x450px，支持 JPG、PNG 格式，大小不超过 2MB ",-1))])]),_:1})])]),n("div",Te,[e[23]||(e[23]=n("div",{class:"card-header"},[n("h2",null,"资讯内容")],-1)),n("div",De,[t(p,{prop:"content"},{default:l(()=>[n("div",Ue,[n("div",Ne,[t(oe,null,{default:l(()=>[t(u,{size:"small",onClick:O},{default:l(()=>[t(c,null,{default:l(()=>[t(ee)]),_:1}),e[20]||(e[20]=m(" 插入图片 "))]),_:1,__:[20]}),t(u,{size:"small",onClick:$},{default:l(()=>[t(c,null,{default:l(()=>[t(te)]),_:1}),e[21]||(e[21]=m(" 插入链接 "))]),_:1,__:[21]}),t(u,{size:"small",onClick:K},{default:l(()=>[t(c,null,{default:l(()=>[t(le)]),_:1}),e[22]||(e[22]=m(" 插入表格 "))]),_:1,__:[22]})]),_:1})]),t(y,{modelValue:a.content,"onUpdate:modelValue":e[7]||(e[7]=o=>a.content=o),type:"textarea",rows:15,placeholder:"请输入资讯内容，支持 HTML 格式",class:"modern-input content-editor"},null,8,["modelValue"])])]),_:1})])]),n("div",Re,[e[28]||(e[28]=n("div",{class:"card-header"},[n("h2",null,"高级设置")],-1)),n("div",Le,[t(p,{label:"标签"},{default:l(()=>[(i(!0),b(R,null,L(a.tags,o=>(i(),_(ae,{key:o,closable:"",onClose:Ye=>J(o),class:"tag-item"},{default:l(()=>[m(U(o),1)]),_:2},1032,["onClose"]))),128)),I.value?(i(),_(y,{key:0,ref_key:"tagInputRef",ref:Y,modelValue:w.value,"onUpdate:modelValue":e[8]||(e[8]=o=>w.value=o),size:"small",onKeyup:pe(P,["enter"]),onBlur:P,class:"tag-input"},null,8,["modelValue"])):(i(),_(u,{key:1,size:"small",onClick:W,class:"add-tag-btn"},{default:l(()=>[t(c,null,{default:l(()=>[t(z)]),_:1}),e[24]||(e[24]=m(" 添加标签 "))]),_:1,__:[24]}))]),_:1}),t(p,{label:"SEO关键词"},{default:l(()=>[t(y,{modelValue:a.keywords,"onUpdate:modelValue":e[9]||(e[9]=o=>a.keywords=o),placeholder:"请输入关键词，用逗号分隔",class:"modern-input"},null,8,["modelValue"])]),_:1}),t(p,{label:"阅读权限"},{default:l(()=>[t(C,{modelValue:a.permission,"onUpdate:modelValue":e[10]||(e[10]=o=>a.permission=o),placeholder:"请选择阅读权限",class:"modern-input",style:{width:"100%"}},{default:l(()=>[t(v,{label:"所有人可见",value:"public"}),t(v,{label:"仅内部员工",value:"internal"}),t(v,{label:"指定部门",value:"department"}),t(v,{label:"指定用户",value:"user"})]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"评论设置"},{default:l(()=>[t(se,{modelValue:a.commentSettings,"onUpdate:modelValue":e[11]||(e[11]=o=>a.commentSettings=o)},{default:l(()=>[t(D,{value:"allowComment"},{default:l(()=>e[25]||(e[25]=[m("允许评论")])),_:1,__:[25]}),t(D,{value:"requireApproval"},{default:l(()=>e[26]||(e[26]=[m("评论需审核")])),_:1,__:[26]}),t(D,{value:"notifyAuthor"},{default:l(()=>e[27]||(e[27]=[m("评论通知作者")])),_:1,__:[27]})]),_:1},8,["modelValue"])]),_:1})])])]),_:1},8,["model"])])])}}},ze=re(Me,[["__scopeId","data-v-2d56d026"]]);export{ze as default};
