import{u as v}from"./user-Bcj8SPsV.js";import{_ as H,c as W,e as G,b as i,A as e,p as t,z as u,a as y,r as R,o as J,E as m,L as N,W as K,k as j,f as c,g as Q,m as X,t as z,H as Y}from"./index-Ntw4s37F.js";const Z={name:"UserManagement",setup(){const V=y(!1),a=y(!1),S=y([]),l=y([]),C=y(!1),k=y(""),d=y(null),r=R({username:"",realName:"",phone:"",status:null}),s=R({page:1,size:10,total:0}),_=R({id:null,username:"",realName:"",phone:"",email:"",gender:0,position:"",employeeNo:"",status:1,remark:""}),p={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],realName:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},g=async()=>{V.value=!0;try{const n={page:s.page,size:s.size,...r},h=await v.getUserList(n);S.value=h.data.records,s.total=h.data.total}catch{m.error("获取用户列表失败")}finally{V.value=!1}},U=()=>{s.page=1,g()},f=()=>{Object.assign(r,{username:"",realName:"",phone:"",status:null}),s.page=1,g()},T=()=>{k.value="新增用户",M(),C.value=!0},D=n=>{k.value="编辑用户",Object.assign(_,n),C.value=!0},B=async n=>{try{await N.confirm(`确定要删除用户 "${n.realName}" 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await v.deleteUser(n.id),m.success("删除成功"),g()}catch(h){h!=="cancel"&&m.error("删除失败")}},b=async()=>{try{await N.confirm(`确定要删除选中的 ${l.value.length} 个用户吗？`,"批量删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const n=l.value.map(h=>h.id);await v.batchDeleteUsers(n),m.success("批量删除成功"),g()}catch(n){n!=="cancel"&&m.error("批量删除失败")}},w=async n=>{const h=n.status===1?0:1,x=h===1?"启用":"禁用";try{await N.confirm(`确定要${x}用户 "${n.realName}" 吗？`,`${x}确认`,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await v.updateUserStatus(n.id,h),m.success(`${x}成功`),g()}catch(I){I!=="cancel"&&m.error(`${x}失败`)}},L=async n=>{try{await N.confirm(`确定要重置用户 "${n.realName}" 的密码吗？重置后密码为：123456`,"重置密码确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await v.resetPassword(n.id),m.success("密码重置成功，新密码为：123456")}catch(h){h!=="cancel"&&m.error("密码重置失败")}},E=async()=>{try{V.value=!0,await v.exportUsers(r),m.success("导出成功")}catch{m.error("导出失败")}finally{V.value=!1}},o=n=>{l.value=n},F=n=>{s.size=n,s.page=1,g()},A=n=>{s.page=n,g()},P=async()=>{try{await d.value.validate(),a.value=!0,_.id?(await v.updateUser(_.id,_),m.success("更新成功")):(await v.createUser(_),m.success("创建成功")),C.value=!1,g()}catch(n){n!==!1&&m.error("操作失败")}finally{a.value=!1}},q=()=>{C.value=!1,M()},M=()=>{var n;Object.assign(_,{id:null,username:"",realName:"",phone:"",email:"",gender:0,position:"",employeeNo:"",status:1,remark:""}),(n=d.value)==null||n.clearValidate()},O=n=>n?new Date(n).toLocaleString("zh-CN"):"";return J(()=>{g()}),{loading:V,submitLoading:a,userList:S,selectedUsers:l,dialogVisible:C,dialogTitle:k,userFormRef:d,searchForm:r,pagination:s,userForm:_,userFormRules:p,getUserList:g,handleSearch:U,handleReset:f,handleAdd:T,handleEdit:D,handleDelete:B,handleBatchDelete:b,handleToggleStatus:w,handleResetPassword:L,handleExport:E,handleSelectionChange:o,handleSizeChange:F,handleCurrentChange:A,handleSubmit:P,handleDialogClose:q,formatDate:O}}},$={class:"user-management"},ee={class:"search-section"},le={class:"action-section"},ae={class:"action-buttons"},te={class:"table-section"},oe={class:"pagination-wrapper"},ne={class:"dialog-footer"};function re(V,a,S,l,C,k){const d=u("el-input"),r=u("el-form-item"),s=u("el-option"),_=u("el-select"),p=u("el-button"),g=u("el-form"),U=u("el-card"),f=u("el-table-column"),T=u("el-tag"),D=u("el-table"),B=u("el-pagination"),b=u("el-col"),w=u("el-row"),L=u("el-dialog"),E=K("loading");return j(),W("div",$,[a[26]||(a[26]=G('<div class="page-header" data-v-1c53f0cd><div class="header-content" data-v-1c53f0cd><h1 class="page-title" data-v-1c53f0cd><i class="el-icon-user" data-v-1c53f0cd></i> 用户管理 </h1><p class="page-description" data-v-1c53f0cd>管理系统用户信息、角色权限和账号状态</p></div></div>',1)),i("div",ee,[e(U,{class:"search-card"},{default:t(()=>[e(g,{model:l.searchForm,inline:!0,class:"search-form"},{default:t(()=>[e(r,{label:"用户名"},{default:t(()=>[e(d,{modelValue:l.searchForm.username,"onUpdate:modelValue":a[0]||(a[0]=o=>l.searchForm.username=o),placeholder:"请输入用户名",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(r,{label:"真实姓名"},{default:t(()=>[e(d,{modelValue:l.searchForm.realName,"onUpdate:modelValue":a[1]||(a[1]=o=>l.searchForm.realName=o),placeholder:"请输入真实姓名",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(r,{label:"手机号"},{default:t(()=>[e(d,{modelValue:l.searchForm.phone,"onUpdate:modelValue":a[2]||(a[2]=o=>l.searchForm.phone=o),placeholder:"请输入手机号",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(r,{label:"状态"},{default:t(()=>[e(_,{modelValue:l.searchForm.status,"onUpdate:modelValue":a[3]||(a[3]=o=>l.searchForm.status=o),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:t(()=>[e(s,{label:"启用",value:1}),e(s,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),e(r,null,{default:t(()=>[e(p,{type:"primary",onClick:l.handleSearch,loading:l.loading},{default:t(()=>a[16]||(a[16]=[i("i",{class:"el-icon-search"},null,-1),c(" 搜索 ")])),_:1,__:[16]},8,["onClick","loading"]),e(p,{onClick:l.handleReset},{default:t(()=>a[17]||(a[17]=[i("i",{class:"el-icon-refresh"},null,-1),c(" 重置 ")])),_:1,__:[17]},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1})]),i("div",le,[i("div",ae,[e(p,{type:"primary",onClick:l.handleAdd},{default:t(()=>a[18]||(a[18]=[i("i",{class:"el-icon-plus"},null,-1),c(" 新增用户 ")])),_:1,__:[18]},8,["onClick"]),e(p,{type:"danger",onClick:l.handleBatchDelete,disabled:l.selectedUsers.length===0},{default:t(()=>a[19]||(a[19]=[i("i",{class:"el-icon-delete"},null,-1),c(" 批量删除 ")])),_:1,__:[19]},8,["onClick","disabled"]),e(p,{type:"success",onClick:l.handleExport},{default:t(()=>a[20]||(a[20]=[i("i",{class:"el-icon-download"},null,-1),c(" 导出数据 ")])),_:1,__:[20]},8,["onClick"])])]),i("div",te,[e(U,{class:"table-card"},{default:t(()=>[Q((j(),X(D,{data:l.userList,onSelectionChange:l.handleSelectionChange,stripe:"",style:{width:"100%"}},{default:t(()=>[e(f,{type:"selection",width:"55"}),e(f,{prop:"id",label:"ID",width:"80"}),e(f,{prop:"username",label:"用户名",width:"120"}),e(f,{prop:"realName",label:"真实姓名",width:"120"}),e(f,{prop:"phone",label:"手机号",width:"130"}),e(f,{prop:"email",label:"邮箱",width:"180"}),e(f,{prop:"position",label:"职位",width:"120"}),e(f,{label:"状态",width:"80"},{default:t(({row:o})=>[e(T,{type:o.status===1?"success":"danger"},{default:t(()=>[c(z(o.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"createTime",label:"创建时间",width:"160"},{default:t(({row:o})=>[c(z(l.formatDate(o.createTime)),1)]),_:1}),e(f,{prop:"lastLoginTime",label:"最后登录",width:"160"},{default:t(({row:o})=>[c(z(o.lastLoginTime?l.formatDate(o.lastLoginTime):"从未登录"),1)]),_:1}),e(f,{label:"操作",width:"280",fixed:"right"},{default:t(({row:o})=>[e(p,{size:"small",onClick:F=>l.handleEdit(o)},{default:t(()=>a[21]||(a[21]=[i("i",{class:"el-icon-edit"},null,-1),c(" 编辑 ")])),_:2,__:[21]},1032,["onClick"]),e(p,{size:"small",type:o.status===1?"warning":"success",onClick:F=>l.handleToggleStatus(o)},{default:t(()=>[i("i",{class:Y(o.status===1?"el-icon-lock":"el-icon-unlock")},null,2),c(" "+z(o.status===1?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),e(p,{size:"small",type:"info",onClick:F=>l.handleResetPassword(o)},{default:t(()=>a[22]||(a[22]=[i("i",{class:"el-icon-key"},null,-1),c(" 重置密码 ")])),_:2,__:[22]},1032,["onClick"]),e(p,{size:"small",type:"danger",onClick:F=>l.handleDelete(o)},{default:t(()=>a[23]||(a[23]=[i("i",{class:"el-icon-delete"},null,-1),c(" 删除 ")])),_:2,__:[23]},1032,["onClick"])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[E,l.loading]]),i("div",oe,[e(B,{"current-page":l.pagination.page,"onUpdate:currentPage":a[4]||(a[4]=o=>l.pagination.page=o),"page-size":l.pagination.size,"onUpdate:pageSize":a[5]||(a[5]=o=>l.pagination.size=o),"page-sizes":[10,20,50,100],total:l.pagination.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:l.handleSizeChange,onCurrentChange:l.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),_:1})]),e(L,{title:l.dialogTitle,modelValue:l.dialogVisible,"onUpdate:modelValue":a[15]||(a[15]=o=>l.dialogVisible=o),width:"600px","before-close":l.handleDialogClose},{footer:t(()=>[i("span",ne,[e(p,{onClick:l.handleDialogClose},{default:t(()=>a[24]||(a[24]=[c("取消")])),_:1,__:[24]},8,["onClick"]),e(p,{type:"primary",onClick:l.handleSubmit,loading:l.submitLoading},{default:t(()=>a[25]||(a[25]=[c(" 确定 ")])),_:1,__:[25]},8,["onClick","loading"])])]),default:t(()=>[e(g,{ref:"userFormRef",model:l.userForm,rules:l.userFormRules,"label-width":"100px"},{default:t(()=>[e(w,{gutter:20},{default:t(()=>[e(b,{span:12},{default:t(()=>[e(r,{label:"用户名",prop:"username"},{default:t(()=>[e(d,{modelValue:l.userForm.username,"onUpdate:modelValue":a[6]||(a[6]=o=>l.userForm.username=o),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:t(()=>[e(r,{label:"真实姓名",prop:"realName"},{default:t(()=>[e(d,{modelValue:l.userForm.realName,"onUpdate:modelValue":a[7]||(a[7]=o=>l.userForm.realName=o),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(w,{gutter:20},{default:t(()=>[e(b,{span:12},{default:t(()=>[e(r,{label:"手机号",prop:"phone"},{default:t(()=>[e(d,{modelValue:l.userForm.phone,"onUpdate:modelValue":a[8]||(a[8]=o=>l.userForm.phone=o),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:t(()=>[e(r,{label:"邮箱",prop:"email"},{default:t(()=>[e(d,{modelValue:l.userForm.email,"onUpdate:modelValue":a[9]||(a[9]=o=>l.userForm.email=o),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(w,{gutter:20},{default:t(()=>[e(b,{span:12},{default:t(()=>[e(r,{label:"性别",prop:"gender"},{default:t(()=>[e(_,{modelValue:l.userForm.gender,"onUpdate:modelValue":a[10]||(a[10]=o=>l.userForm.gender=o),placeholder:"请选择性别",style:{width:"100%"}},{default:t(()=>[e(s,{label:"未知",value:0}),e(s,{label:"男",value:1}),e(s,{label:"女",value:2})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:t(()=>[e(r,{label:"职位",prop:"position"},{default:t(()=>[e(d,{modelValue:l.userForm.position,"onUpdate:modelValue":a[11]||(a[11]=o=>l.userForm.position=o),placeholder:"请输入职位"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(w,{gutter:20},{default:t(()=>[e(b,{span:12},{default:t(()=>[e(r,{label:"工号",prop:"employeeNo"},{default:t(()=>[e(d,{modelValue:l.userForm.employeeNo,"onUpdate:modelValue":a[12]||(a[12]=o=>l.userForm.employeeNo=o),placeholder:"请输入工号"},null,8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:t(()=>[e(r,{label:"状态",prop:"status"},{default:t(()=>[e(_,{modelValue:l.userForm.status,"onUpdate:modelValue":a[13]||(a[13]=o=>l.userForm.status=o),placeholder:"请选择状态",style:{width:"100%"}},{default:t(()=>[e(s,{label:"启用",value:1}),e(s,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(r,{label:"备注",prop:"remark"},{default:t(()=>[e(d,{modelValue:l.userForm.remark,"onUpdate:modelValue":a[14]||(a[14]=o=>l.userForm.remark=o),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","before-close"])])}const de=H(Z,[["render",re],["__scopeId","data-v-1c53f0cd"]]);export{de as default};
