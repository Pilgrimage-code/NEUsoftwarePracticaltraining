import{_ as z,af as M,ab as j,ac as A,c as _,b as e,A as r,p as u,z as n,t as a,F,d as O,u as q,a as h,G,r as B,l as H,o as J,E as L,j as K,k as g,f as p}from"./index-Ntw4s37F.js";import{c as P}from"./course-DBRud_bH.js";import{g as Q}from"./learning-C_xxH9mD.js";const W={name:"LearningDetail",components:{User:A,Clock:j,Calendar:M},setup(){const f=G(),s=K(),x=q(),t=h(!0),d=h(parseInt(f.params.courseId)||0);h(f.query.recordId||0);const k=B({}),c=B({}),v=h([]),y=h({}),b=h(0),m=async()=>{t.value=!0;try{const o=await P.getCourseById(d.value);o.code===200?(Object.assign(k,o.data),await w()):L.error("获取课程信息失败"),await I()}catch(o){console.error("获取学习详情失败:",o),L.error("获取学习详情失败")}finally{t.value=!1}},w=async()=>{try{const o=await P.getCourseChapters(d.value);o.code===200&&(v.value=o.data||[],v.value.forEach(i=>{y.value[i.id]=Math.floor(Math.random()*100)}))}catch(o){console.error("获取章节列表失败:",o)}},I=async()=>{try{const o=x.userId||1,i=await Q(o,d.value);i.code===200&&i.data?Object.assign(c,i.data):Object.assign(c,{userId:o,courseId:d.value,progress:0,status:0,studyDuration:0})}catch(o){console.error("获取学习记录失败:",o)}},D=o=>y.value[o]||0,C=o=>o?new Date(o).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"暂无数据",R=o=>{if(!o)return"0分钟";if(o<60)return`${o}分钟`;const i=Math.floor(o/60),T=o%60;return i>0?`${i}小时${T>0?`${T}分钟`:""}`:`${T}分钟`},E=o=>{switch(o){case 0:return"info";case 1:return"primary";case 2:return"success";case 3:return"warning";default:return"info"}},l=o=>{switch(o){case 0:return"未开始";case 1:return"学习中";case 2:return"已完成";case 3:return"已暂停";default:return"未知"}},S=o=>o>=100?"#67C23A":o>=60?"#409EFF":"#E6A23C",N=o=>{o.target.src="/default-course.png"},U=()=>{c.lastChapterId?s.push(`/dashboard/course-detail/${d.value}?chapterId=${c.lastChapterId}&action=resume`):s.push(`/dashboard/course-detail/${d.value}?action=start`)},V=()=>{s.back()};return H(()=>f.params.courseId,o=>{o&&(d.value=parseInt(o),m())}),J(()=>{m()}),{loading:t,course:k,learningRecord:c,chapters:v,rating:b,formatDate:C,formatDuration:R,getStatusType:E,getStatusText:l,getProgressColor:S,getChapterProgress:D,handleImageError:N,continueLearning:U,goBack:V}}},X={class:"learning-detail"},Y={class:"page-header"},Z={key:0,class:"loading-container"},$={key:1,class:"detail-container"},ee={class:"course-info card"},se={class:"card-body"},te={class:"course-header"},oe={class:"course-image"},re={class:"course-meta"},ae={class:"course-title"},ne={class:"meta-items"},ce={class:"meta-item"},le={class:"meta-item"},ie={class:"meta-item"},de={class:"learning-progress"},ue={class:"progress-header"},_e={class:"progress-percentage"},ge={class:"progress-detail"},me={class:"detail-item"},he={class:"value"},ve={class:"detail-item"},pe={class:"value"},fe={class:"detail-item"},ye={class:"value"},Ce={class:"action-buttons"},ke={class:"chapter-progress card"},be={class:"card-body"},we={key:0,class:"no-data"},Ie={key:1,class:"chapter-list"},De={class:"chapter-info"},Re={class:"chapter-number"},Ee={class:"chapter-content"},Se={class:"chapter-name"},Te={class:"chapter-duration"},xe={class:"chapter-status"},Be={class:"notes-reviews card"},Le={class:"card-body"},Pe={class:"notes-section"},Ne={class:"review-section"},Ue={class:"rating-input"};function Ve(f,s,x,t,d,k){const c=n("el-button"),v=n("el-skeleton"),y=n("el-image"),b=n("User"),m=n("el-icon"),w=n("Clock"),I=n("Calendar"),D=n("el-tag"),C=n("el-progress"),R=n("el-divider"),E=n("el-rate");return g(),_("div",X,[e("div",Y,[r(c,{icon:"Back",onClick:t.goBack},{default:u(()=>s[1]||(s[1]=[p("返回")])),_:1,__:[1]},8,["onClick"]),s[2]||(s[2]=e("h2",null,"学习详情",-1))]),t.loading?(g(),_("div",Z,[r(v,{rows:10,animated:""})])):(g(),_("div",$,[e("div",ee,[s[8]||(s[8]=e("div",{class:"card-header"},[e("h3",null,"课程信息")],-1)),e("div",se,[e("div",te,[e("div",oe,[r(y,{src:t.course.coverImage||"/default-course.png",fit:"cover",onError:t.handleImageError},null,8,["src","onError"])]),e("div",re,[e("h4",ae,a(t.course.courseName||"未知课程"),1),e("div",ne,[e("div",ce,[r(m,null,{default:u(()=>[r(b)]),_:1}),e("span",null,"讲师："+a(t.course.instructor||"-"),1)]),e("div",le,[r(m,null,{default:u(()=>[r(w)]),_:1}),e("span",null,"课程时长："+a(t.formatDuration(t.course.duration)),1)]),e("div",ie,[r(m,null,{default:u(()=>[r(I)]),_:1}),e("span",null,"发布日期："+a(t.formatDate(t.course.createTime)),1)])])])]),e("div",de,[e("div",ue,[s[3]||(s[3]=e("span",null,"学习进度",-1)),e("span",_e,a(t.learningRecord.progress||0)+"%",1),r(D,{type:t.getStatusType(t.learningRecord.status),size:"small"},{default:u(()=>[p(a(t.getStatusText(t.learningRecord.status)),1)]),_:1},8,["type"])]),r(C,{percentage:t.learningRecord.progress||0,color:t.getProgressColor(t.learningRecord.progress)},null,8,["percentage","color"]),e("div",ge,[e("div",me,[s[4]||(s[4]=e("span",{class:"label"},"首次学习：",-1)),e("span",he,a(t.formatDate(t.learningRecord.createTime)),1)]),e("div",ve,[s[5]||(s[5]=e("span",{class:"label"},"最近学习：",-1)),e("span",pe,a(t.formatDate(t.learningRecord.updateTime)),1)]),e("div",fe,[s[6]||(s[6]=e("span",{class:"label"},"学习时长：",-1)),e("span",ye,a(t.formatDuration(t.learningRecord.studyDuration||0)),1)])])]),e("div",Ce,[r(c,{type:"primary",onClick:t.continueLearning},{default:u(()=>s[7]||(s[7]=[p(" 继续学习 ")])),_:1,__:[7]},8,["onClick"])])])]),e("div",ke,[s[9]||(s[9]=e("div",{class:"card-header"},[e("h3",null,"章节学习详情")],-1)),e("div",be,[t.chapters.length===0?(g(),_("div",we," 暂无章节信息 ")):(g(),_("div",Ie,[(g(!0),_(F,null,O(t.chapters,(l,S)=>(g(),_("div",{key:l.id,class:"chapter-item"},[e("div",De,[e("div",Re,a(S+1),1),e("div",Ee,[e("div",Se,a(l.chapterName),1),e("div",Te,"时长："+a(t.formatDuration(l.duration||0)),1)])]),e("div",xe,[r(C,{type:"circle",width:40,"stroke-width":6,percentage:t.getChapterProgress(l.id),color:t.getProgressColor(t.getChapterProgress(l.id))},null,8,["percentage","color"])])]))),128))]))])]),e("div",Be,[s[16]||(s[16]=e("div",{class:"card-header"},[e("h3",null,"学习笔记与评价")],-1)),e("div",Le,[e("div",Pe,[s[11]||(s[11]=e("h4",null,"学习笔记",-1)),s[12]||(s[12]=e("div",{class:"no-data"}," 您还没有添加任何学习笔记 ",-1)),r(c,{size:"small",type:"primary",plain:""},{default:u(()=>s[10]||(s[10]=[p("添加笔记")])),_:1,__:[10]})]),r(R),e("div",Ne,[s[14]||(s[14]=e("h4",null,"课程评价",-1)),s[15]||(s[15]=e("div",{class:"no-data"}," 您还没有评价此课程 ",-1)),e("div",Ue,[r(E,{modelValue:t.rating,"onUpdate:modelValue":s[0]||(s[0]=l=>t.rating=l),"allow-half":"","show-score":""},null,8,["modelValue"]),r(c,{size:"small",type:"primary",plain:""},{default:u(()=>s[13]||(s[13]=[p("提交评价")])),_:1,__:[13]})])])])])]))])}const Ae=z(W,[["render",Ve],["__scopeId","data-v-5609e3fc"]]);export{Ae as default};
