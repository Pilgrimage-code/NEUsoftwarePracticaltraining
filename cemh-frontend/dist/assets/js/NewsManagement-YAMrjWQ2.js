import{_ as he,O as _e,P as ve,Q as we,R as be,S as ye,U as Ie,V as Ce,c as x,b as r,A as a,f as h,p as l,z as i,a as c,r as Q,o as ae,E as u,L as X,N as Y,W as Ve,k as _,g as xe,m as E,t as L,F as Z,d as $,w as ee,C as te}from"./index-Ntw4s37F.js";import{n as T}from"./news-DTpBK1zx.js";c([]);ae(()=>{loadTenantAndCategory(),getNewsList()});class ke{constructor(t){this.container=t,this.init()}init(){const t=document.createElement("div");t.className="editor-toolbar",t.innerHTML=`
      <button type="button" data-command="bold" title="粗体"><b>B</b></button>
      <button type="button" data-command="italic" title="斜体"><i>I</i></button>
      <button type="button" data-command="underline" title="下划线"><u>U</u></button>
      <button type="button" data-command="insertOrderedList" title="有序列表">1.</button>
      <button type="button" data-command="insertUnorderedList" title="无序列表">•</button>
      <button type="button" data-command="justifyLeft" title="左对齐">←</button>
      <button type="button" data-command="justifyCenter" title="居中">↔</button>
      <button type="button" data-command="justifyRight" title="右对齐">→</button>
    `;const v=document.createElement("div");v.className="editor-content",v.contentEditable=!0,v.innerHTML="<p><br></p>",this.container.appendChild(t),this.container.appendChild(v),this.toolbar=t,this.editor=v,this.bindEvents()}bindEvents(){this.toolbar.addEventListener("click",t=>{if(t.target.tagName==="BUTTON"){t.preventDefault();const v=t.target.dataset.command;document.execCommand(v,!1,null),this.editor.focus()}}),this.editor.addEventListener("focus",()=>{this.container.classList.add("focused")}),this.editor.addEventListener("blur",()=>{this.container.classList.remove("focused")})}getContent(){return this.editor.innerHTML}setContent(t){this.editor.innerHTML=t||"<p><br></p>"}destroy(){this.container&&(this.container.innerHTML="")}}const Ne={name:"NewsManagement",components:{Document:Ce,Search:Ie,Refresh:ye,Plus:be,Delete:we,View:ve,Edit:_e},setup(){const D=c(!1),t=c(!1),v=c([]),e=c([]),k=c(!1),q=c(!1),U=c(!1),g=c(""),w=c(null),m=c(null),O=c(null),f=c(null),B=c(""),N=c([]),M=c([]),F=c([]);let p=null;const I=async()=>{try{const s=await(await fetch("http://localhost:8080/api/tenants/all")).json();s.code===200&&(N.value=s.data.map(R=>({value:R.id,label:R.tenantName})));const K=await(await fetch("http://localhost:8080/api/news-categories/all")).json();K.code===200&&(F.value=K.data.map(R=>({value:R.id,label:R.categoryName}))),console.log("企业列表",N.value),console.log("分类列表",F.value)}catch(n){console.error("加载数据失败:",n),u.error("加载数据失败")}},C=c("http://localhost:8080/api/upload/image"),j=c({Authorization:`Bearer ${localStorage.getItem("token")||""}`}),S=Q({title:"",summary:"",author:"",coverImage:""}),b=Q({page:1,size:10,total:0}),d=Q({id:null,title:"",summary:"",content:"",author:"",coverImage:"",tenantId:""}),P={title:[{required:!0,message:"新闻标题不能为空",trigger:"blur"},{min:1,max:100,message:"标题长度在 1 到 100 个字符",trigger:"blur"}],summary:[{required:!0,message:"新闻简介不能为空",trigger:"blur"},{min:1,max:500,message:"简介长度在 1 到 500 个字符",trigger:"blur"}],author:[{required:!0,message:"作者不能为空",trigger:"blur"},{min:1,max:50,message:"作者长度在 1 到 50 个字符",trigger:"blur"}],content:[{required:!0,message:"新闻内容不能为空",trigger:"blur"}],coverImage:[{required:!0,message:"新闻图片不能为空",trigger:"change"}],tenantId:[{required:!0,message:"请选择所属企业",trigger:"change"}]},A=n=>n?new Date(n).toLocaleString("zh-CN"):"-",y=async()=>{D.value=!0;try{const n={page:b.page,size:b.size,...S},s=await T.getNewsList(n,localStorage.getItem("tenantId"));s.code===200?(v.value=s.data.records||[],b.total=s.data.total||0):u.error(s.message||"获取资讯列表失败")}catch(n){console.error("获取资讯列表失败:",n),u.error("获取资讯列表失败")}finally{D.value=!1}},z=()=>{b.page=1,y()},W=()=>{Object.assign(S,{title:"",summary:"",author:"",coverImage:""}),b.page=1,y()},o=async()=>{await I(),J(),g.value="新增资讯",k.value=!0,Y(()=>{G()})},H=n=>{g.value="修改资讯",Object.assign(d,{...n}),k.value=!0,Y(()=>{G(),p&&p.setContent(d.content)})},le=n=>{f.value=n,q.value=!0},oe=async n=>{try{await X.confirm(`确定要删除资讯"${n.title}"吗？`,"删除确认",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"});const s=await T.deleteNews(n.id,localStorage.getItem("tenantId"));s.code===200?(u.success("删除成功"),y()):u.error(s.message||"删除失败")}catch(s){s!=="cancel"&&(console.error("删除失败:",s),u.error("删除失败"))}},ne=async()=>{try{await X.confirm(`确定要删除选中的 ${e.value.length} 条资讯吗？`,"批量删除确认",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"});const n=e.value.map(V=>V.id),s=await T.batchDeleteNews(n,localStorage.getItem("tenantId"));s.code===200?(u.success("批量删除成功"),y()):u.error(s.message||"批量删除失败")}catch(n){n!=="cancel"&&(console.error("批量删除失败:",n),u.error("批量删除失败"))}},re=n=>{e.value=n},se=n=>{b.size=n,b.page=1,y()},ie=n=>{b.page=n,y()},G=()=>{m.value&&!p&&(p=new ke(m.value))},de=n=>{const s=n.type.startsWith("image/"),V=n.size/1024/1024<2;return s?V?!0:(u.error("图片大小不能超过 2MB!"),!1):(u.error("只能上传图片文件!"),!1)},ce=n=>{n.code===200?(d.coverImage=n.data.url,u.success("图片上传成功")):u.error(n.message||"图片上传失败")},ue=()=>{u.error("图片上传失败")},me=()=>{B.value=d.coverImage,U.value=!0},ge=()=>{d.coverImage=""},pe=async()=>{if(w.value){p&&(d.content=p.getContent());try{if(await w.value.validate(),!d.content||d.content.trim()==="<p><br></p>"||d.content.trim()===""){u.error("新闻内容不能为空");return}t.value=!0;let n;const s=localStorage.getItem("tenantId"),V=localStorage.getItem("userId");d.id?n=await T.updateNews(d.id,d,s,V):n=await T.createNews(d,s,V),n.code===200?(u.success(d.id?"修改成功":"创建成功"),k.value=!1,y()):u.error(n.message||(d.id?"修改失败":"创建失败"))}catch(n){console.error("提交失败:",n),u.error(d.id?"修改失败":"创建失败")}finally{t.value=!1}}},fe=()=>{k.value=!1,p&&(p.destroy(),p=null)},J=()=>{Object.assign(d,{id:null,title:"",summary:"",content:"",author:"",coverImage:"",tenantId:""}),p&&p.setContent("")};return ae(()=>{y()}),{loading:D,submitLoading:t,newsList:v,selectedNews:e,dialogVisible:k,viewDialogVisible:q,imagePreviewVisible:U,dialogTitle:g,newsFormRef:w,editorRef:m,uploadRef:O,currentNews:f,previewImageUrl:B,uploadAction:C,uploadHeaders:j,searchForm:S,pagination:b,newsForm:d,newsFormRules:P,tenantList:N,deptList:M,categoryList:F,formatDate:A,getNewsList:y,handleSearch:z,handleReset:W,handleAdd:o,handleEdit:H,handleView:le,handleDelete:oe,handleBatchDelete:ne,handleSelectionChange:re,handleSizeChange:se,handleCurrentChange:ie,beforeImageUpload:de,handleImageSuccess:ce,handleImageError:ue,handleImagePreview:me,handleImageRemove:ge,handleSubmit:pe,handleDialogClose:fe,resetNewsForm:J}}},Fe={class:"news-management"},Le={class:"page-header"},De={class:"header-content"},Se={class:"page-title"},ze={class:"search-section"},Re={class:"action-section"},Ee={class:"action-buttons"},Te={class:"table-section"},Ue={class:"news-title"},Be={class:"pagination-wrapper"},Me={class:"image-upload-container"},je={key:0,class:"image-preview"},Pe={class:"image-overlay"},Ae={key:1,class:"upload-placeholder"},He={class:"rich-editor-container"},qe={ref:"editorRef",class:"rich-editor"},Oe={class:"dialog-footer"},We={key:0,class:"news-detail"},Qe={class:"news-meta"},Ge={class:"news-summary"},Je={key:0,class:"news-image"},Ke={class:"news-content"},Xe=["innerHTML"];function Ye(D,t,v,e,k,q){const U=i("Document"),g=i("el-icon"),w=i("el-input"),m=i("el-form-item"),O=i("Search"),f=i("el-button"),B=i("Refresh"),N=i("el-form"),M=i("el-card"),F=i("Plus"),p=i("Delete"),I=i("el-table-column"),C=i("el-image"),j=i("View"),S=i("Edit"),b=i("el-table"),d=i("el-pagination"),P=i("el-option"),A=i("el-select"),y=i("el-upload"),z=i("el-dialog"),W=Ve("loading");return _(),x("div",Fe,[r("div",Le,[r("div",De,[r("h1",Se,[a(g,null,{default:l(()=>[a(U)]),_:1}),t[14]||(t[14]=h(" 资讯管理 "))]),t[15]||(t[15]=r("p",{class:"page-description"},"管理系统资讯内容、分类和发布状态",-1))])]),r("div",ze,[a(M,{class:"search-card"},{default:l(()=>[a(N,{model:e.searchForm,inline:!0,class:"search-form"},{default:l(()=>[a(m,{label:"新闻标题"},{default:l(()=>[a(w,{modelValue:e.searchForm.title,"onUpdate:modelValue":t[0]||(t[0]=o=>e.searchForm.title=o),placeholder:"请输入新闻标题",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),a(m,{label:"新闻简介"},{default:l(()=>[a(w,{modelValue:e.searchForm.summary,"onUpdate:modelValue":t[1]||(t[1]=o=>e.searchForm.summary=o),placeholder:"请输入新闻简介",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),a(m,{label:"作者"},{default:l(()=>[a(w,{modelValue:e.searchForm.author,"onUpdate:modelValue":t[2]||(t[2]=o=>e.searchForm.author=o),placeholder:"请输入作者",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),a(m,{label:"新闻图片路径"},{default:l(()=>[a(w,{modelValue:e.searchForm.coverImage,"onUpdate:modelValue":t[3]||(t[3]=o=>e.searchForm.coverImage=o),placeholder:"请输入图片路径",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),a(m,null,{default:l(()=>[a(f,{type:"primary",onClick:e.handleSearch,loading:e.loading},{default:l(()=>[a(g,null,{default:l(()=>[a(O)]),_:1}),t[16]||(t[16]=h(" 搜索 "))]),_:1,__:[16]},8,["onClick","loading"]),a(f,{onClick:e.handleReset},{default:l(()=>[a(g,null,{default:l(()=>[a(B)]),_:1}),t[17]||(t[17]=h(" 重置 "))]),_:1,__:[17]},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1})]),r("div",Re,[r("div",Ee,[a(f,{type:"primary",onClick:e.handleAdd},{default:l(()=>[a(g,null,{default:l(()=>[a(F)]),_:1}),t[18]||(t[18]=h(" 新增 "))]),_:1,__:[18]},8,["onClick"]),a(f,{type:"danger",onClick:e.handleBatchDelete,disabled:e.selectedNews.length===0},{default:l(()=>[a(g,null,{default:l(()=>[a(p)]),_:1}),t[19]||(t[19]=h(" 批量删除 "))]),_:1,__:[19]},8,["onClick","disabled"])])]),r("div",Te,[a(M,{class:"table-card"},{default:l(()=>[xe((_(),E(b,{data:e.newsList,onSelectionChange:e.handleSelectionChange,stripe:"",style:{width:"100%"}},{default:l(()=>[a(I,{type:"selection",width:"55"}),a(I,{prop:"id",label:"ID",width:"80"}),a(I,{prop:"title",label:"新闻标题","min-width":"200"},{default:l(({row:o})=>[r("div",Ue,[r("span",null,L(o.title),1)])]),_:1}),a(I,{prop:"summary",label:"新闻简介","min-width":"200","show-overflow-tooltip":""}),a(I,{prop:"coverImage",label:"新闻图片",width:"120"},{default:l(({row:o})=>[o.coverImage?(_(),E(C,{key:0,src:o.coverImage,"preview-src-list":[o.coverImage],style:{width:"50px",height:"50px"},fit:"cover"},null,8,["src","preview-src-list"])):(_(),E(C,{key:1,src:"http://localhost:8080/uplutupianoads/20250624_2fd82057-eb5a-44e7-8d36-4d96a6d09f88.png",style:{width:"50px",height:"50px"},fit:"cover"}))]),_:1}),a(I,{prop:"author",label:"作者",width:"100"}),a(I,{prop:"createTime",label:"创建时间",width:"160"},{default:l(({row:o})=>[h(L(e.formatDate(o.createTime)),1)]),_:1}),a(I,{label:"操作",width:"200",fixed:"right"},{default:l(({row:o})=>[a(f,{size:"small",onClick:H=>e.handleView(o)},{default:l(()=>[a(g,null,{default:l(()=>[a(j)]),_:1}),t[20]||(t[20]=h(" 查看 "))]),_:2,__:[20]},1032,["onClick"]),a(f,{size:"small",onClick:H=>e.handleEdit(o)},{default:l(()=>[a(g,null,{default:l(()=>[a(S)]),_:1}),t[21]||(t[21]=h(" 修改 "))]),_:2,__:[21]},1032,["onClick"]),a(f,{size:"small",type:"danger",onClick:H=>e.handleDelete(o)},{default:l(()=>[a(g,null,{default:l(()=>[a(p)]),_:1}),t[22]||(t[22]=h(" 删除 "))]),_:2,__:[22]},1032,["onClick"])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[W,e.loading]]),r("div",Be,[a(d,{"current-page":e.pagination.page,"onUpdate:currentPage":t[4]||(t[4]=o=>e.pagination.page=o),"page-size":e.pagination.size,"onUpdate:pageSize":t[5]||(t[5]=o=>e.pagination.size=o),"page-sizes":[10,20,50,100],total:e.pagination.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:e.handleSizeChange,onCurrentChange:e.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),_:1})]),a(z,{title:e.dialogTitle,modelValue:e.dialogVisible,"onUpdate:modelValue":t[11]||(t[11]=o=>e.dialogVisible=o),width:"900px","before-close":e.handleDialogClose,"destroy-on-close":""},{footer:l(()=>[r("span",Oe,[a(f,{onClick:e.handleDialogClose},{default:l(()=>t[25]||(t[25]=[h("取消")])),_:1,__:[25]},8,["onClick"]),a(f,{type:"primary",onClick:e.handleSubmit,loading:e.submitLoading},{default:l(()=>t[26]||(t[26]=[h(" 确定 ")])),_:1,__:[26]},8,["onClick","loading"])])]),default:l(()=>[a(N,{ref:"newsFormRef",model:e.newsForm,rules:e.newsFormRules,"label-width":"120px"},{default:l(()=>[a(m,{label:"新闻标题",prop:"title"},{default:l(()=>[a(w,{modelValue:e.newsForm.title,"onUpdate:modelValue":t[6]||(t[6]=o=>e.newsForm.title=o),placeholder:"请输入新闻标题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),a(m,{label:"新闻简介",prop:"summary"},{default:l(()=>[a(w,{modelValue:e.newsForm.summary,"onUpdate:modelValue":t[7]||(t[7]=o=>e.newsForm.summary=o),type:"textarea",rows:3,placeholder:"请输入新闻简介",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),a(m,{label:"所属企业",prop:"tenantId"},{default:l(()=>[a(A,{modelValue:e.newsForm.tenantId,"onUpdate:modelValue":t[8]||(t[8]=o=>e.newsForm.tenantId=o),placeholder:"请选择所属企业"},{default:l(()=>[(_(!0),x(Z,null,$(e.tenantList,o=>(_(),E(P,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"资讯分类",prop:"categoryId"},{default:l(()=>[a(A,{modelValue:e.newsForm.categoryId,"onUpdate:modelValue":t[9]||(t[9]=o=>e.newsForm.categoryId=o),placeholder:"请选择资讯分类"},{default:l(()=>[(_(!0),x(Z,null,$(e.categoryList,o=>(_(),E(P,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"作者",prop:"author"},{default:l(()=>[a(w,{modelValue:e.newsForm.author,"onUpdate:modelValue":t[10]||(t[10]=o=>e.newsForm.author=o),placeholder:"请输入作者",maxlength:"50"},null,8,["modelValue"])]),_:1}),a(m,{label:"新闻图片",prop:"coverImage"},{default:l(()=>[r("div",Me,[a(y,{ref:"uploadRef",action:e.uploadAction,headers:e.uploadHeaders,"before-upload":e.beforeImageUpload,"on-success":e.handleImageSuccess,"on-error":e.handleImageError,"show-file-list":!1,accept:"image/*",class:"image-uploader"},{default:l(()=>[e.newsForm.coverImage?(_(),x("div",je,[a(C,{src:e.newsForm.coverImage,style:{width:"150px",height:"150px"},fit:"cover"},null,8,["src"]),r("div",Pe,[a(f,{size:"small",type:"primary",onClick:ee(e.handleImagePreview,["stop"])},{default:l(()=>[a(g,null,{default:l(()=>[a(j)]),_:1})]),_:1},8,["onClick"]),a(f,{size:"small",type:"danger",onClick:ee(e.handleImageRemove,["stop"])},{default:l(()=>[a(g,null,{default:l(()=>[a(p)]),_:1})]),_:1},8,["onClick"])])])):(_(),x("div",Ae,[a(g,{class:"upload-icon"},{default:l(()=>[a(F)]),_:1}),t[23]||(t[23]=r("div",{class:"upload-text"},"点击上传图片",-1))]))]),_:1},8,["action","headers","before-upload","on-success","on-error"]),t[24]||(t[24]=r("div",{class:"upload-tips"}," 支持 jpg、png、gif 格式，文件大小不超过 2MB ",-1))])]),_:1}),a(m,{label:"新闻内容",prop:"content"},{default:l(()=>[r("div",He,[r("div",qe,null,512)])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","before-close"]),a(z,{title:"查看资讯",modelValue:e.viewDialogVisible,"onUpdate:modelValue":t[12]||(t[12]=o=>e.viewDialogVisible=o),width:"800px"},{default:l(()=>[e.currentNews?(_(),x("div",We,[r("h2",null,L(e.currentNews.title),1),r("div",Qe,[r("span",null,"作者："+L(e.currentNews.author),1),r("span",null,"创建时间："+L(e.formatDate(e.currentNews.createTime)),1)]),r("div",Ge,[t[27]||(t[27]=r("strong",null,"简介：",-1)),h(L(e.currentNews.summary),1)]),e.currentNews.coverImage?(_(),x("div",Je,[t[28]||(t[28]=r("strong",null,"图片：",-1)),a(C,{src:e.currentNews.coverImage,"preview-src-list":[e.currentNews.coverImage],style:{"max-width":"100%","margin-top":"10px"}},null,8,["src","preview-src-list"])])):te("",!0),r("div",Ke,[t[29]||(t[29]=r("strong",null,"内容：",-1)),r("div",{innerHTML:e.currentNews.content,class:"content-html"},null,8,Xe)])])):te("",!0)]),_:1},8,["modelValue"]),a(z,{title:"图片预览",modelValue:e.imagePreviewVisible,"onUpdate:modelValue":t[13]||(t[13]=o=>e.imagePreviewVisible=o),width:"600px"},{default:l(()=>[a(C,{src:e.previewImageUrl,style:{width:"100%"},fit:"contain"},null,8,["src"])]),_:1},8,["modelValue"])])}const et=he(Ne,[["render",Ye],["__scopeId","data-v-235c06ff"]]);export{et as default};
