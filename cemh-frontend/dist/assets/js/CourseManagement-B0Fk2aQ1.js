import{_ as $,a0 as _e,a as U,D as W,l as Z,c as T,A as l,C as G,p as r,z as d,b as F,t as O,E as m,N as ee,a1 as ye,k as S,a2 as oe,f as b,a3 as be,R as ae,r as K,m as J,P as Ue,a4 as we,a5 as Ce,S as Ve,U as ke,g as le,W as Se,o as Fe,j as Ne,L as Pe}from"./index-Ntw4s37F.js";import{c as z}from"./course-DBRud_bH.js";const xe={name:"FileUpload",components:{UploadFilled:_e},props:{fileType:{type:String,default:"image",validator:a=>["image","video","document","file"].includes(a)},buttonText:{type:String,default:"上传文件"},buttonType:{type:String,default:"primary"},tip:{type:String,default:""},showFileList:{type:Boolean,default:!1},showPreview:{type:Boolean,default:!0},autoUpload:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},limit:{type:Number,default:1},multiple:{type:Boolean,default:!1},initialFileUrl:{type:String,default:""},initialFileName:{type:String,default:""}},emits:["update:fileUrl","update:fileName","upload-success","upload-error","upload-progress","file-change"],setup(a,{emit:e}){const _=U(null),o=U([]),g=U(null),f=U(a.initialFileUrl||""),w=U(a.initialFileName||""),v=U(!1),V=U(0),h=U(""),P=W(()=>{switch(a.fileType){case"image":return"image/*";case"video":return"video/*";case"document":return".doc,.docx,.pdf,.xls,.xlsx,.ppt,.pptx,.txt";default:return""}}),I=W(()=>"javascript:void(0);"),x=W(()=>V.value===100&&h.value==="success"?"上传成功":h.value==="exception"?"上传失败":`上传中 ${V.value}%`),N=()=>{o.value=[],g.value=null,V.value=0,h.value="",v.value=!1},y=async()=>{if(!g.value){m.warning("请先选择文件");return}v.value=!0,V.value=0,h.value="";try{console.log("开始上传文件:",g.value.name,"类型:",a.fileType);const n=new FormData;n.append("file",g.value.raw);const L={headers:{"Content-Type":"multipart/form-data"},onUploadProgress:A=>{const q=Math.round(A.loaded*100/A.total);V.value=q,e("upload-progress",q),console.log(`上传进度: ${q}%`)}};let k,D="";switch(a.fileType){case"image":D="/api/upload/image";break;case"video":D="/api/upload/video";break;case"document":D="/api/upload/document";break;default:D="/api/upload/file"}if(k=await ye.post(`http://localhost:8080${D}`,n,L),k=k.data,k.code===200){if(V.value=100,h.value="success",f.value=k.data.url,w.value=k.data.name||g.value.name,a.fileType==="video"){const q="http://localhost:8080";if(!/\/uploads\/\d{8}_[a-f0-9-]+\.\w+$/.test(f.value)){const Q=f.value.split("/"),B=Q[Q.length-1];console.log("文件名:",B),f.value=`${q}/uploads/${B}`}console.log("修正后的视频URL:",f.value)}e("update:fileUrl",f.value),e("update:fileName",w.value);const A={url:f.value,name:w.value,size:k.data.size,response:k};e("upload-success",A),console.log("上传成功, 最终URL:",f.value),m.success("上传成功")}else throw new Error(k.message||"上传失败")}catch(n){console.error("上传失败:",n),h.value="exception",e("upload-error",n),m.error(`上传失败: ${n.message||"未知错误"}`)}finally{v.value=!1}},R=n=>{console.log("文件变更:",n),g.value=n,e("file-change",n),a.autoUpload&&n&&n.raw&&ee(()=>{y()})},E=n=>{m.warning(`最多只能上传${a.limit}个文件`)},u=n=>{console.error("上传错误:",n),h.value="exception",e("upload-error",n),m.error("上传失败")},p=n=>(console.log("准备上传文件:",n.name,"大小:",n.size),c(n)?n.size/1024/1024<20?!0:(m.error("文件大小不能超过20MB"),!1):(m.error("文件类型不符合要求"),!1)),c=n=>{const L=n.name.toLowerCase();switch(a.fileType){case"image":return/\.(jpg|jpeg|png|gif|bmp|webp)$/.test(L);case"video":return/\.(mp4|webm|ogg|mov|avi|wmv|flv|mkv)$/.test(L);case"document":return/\.(doc|docx|pdf|xls|xlsx|ppt|pptx|txt)$/.test(L);default:return!0}},C=n=>{console.error("预览加载失败:",n),n.target.classList.add("preview-error"),m.warning("文件预览加载失败")};return Z(()=>a.initialFileUrl,n=>{n!==f.value&&(f.value=n)}),Z(()=>a.initialFileName,n=>{n!==w.value&&(w.value=n)}),{uploadRef:_,fileList:o,fileUrl:f,fileName:w,uploading:v,uploadProgress:V,uploadStatus:h,progressText:x,accept:P,action:I,upload:y,reset:N,handleChange:R,handleExceed:E,handleError:u,beforeUpload:p,handlePreviewError:C,currentFile:g}}},Ie={class:"file-upload-component"},Te={key:0,class:"el-upload__tip"},Le={key:0,class:"upload-progress"},Re={class:"progress-text"},Ee={key:1,class:"upload-preview"},De={key:0,class:"image-preview"},qe=["src"],Oe={key:1,class:"video-preview"},ze=["src"],Ae={class:"video-info"},Be={class:"video-name"},Me={key:2,class:"file-info"};function je(a,e,_,o,g,f){const w=d("upload-filled"),v=d("el-icon"),V=d("el-button"),h=d("el-upload"),P=d("el-progress"),I=d("el-tag"),x=d("el-link");return S(),T("div",Ie,[l(h,{action:o.action,accept:o.accept,multiple:_.multiple,limit:_.limit,disabled:_.disabled||o.uploading,"auto-upload":!1,"show-file-list":_.showFileList,"on-change":o.handleChange,"on-exceed":o.handleExceed,"on-error":o.handleError,"before-upload":o.beforeUpload,"file-list":o.fileList,class:"file-uploader",ref:"uploadRef"},{trigger:r(()=>[oe(a.$slots,"trigger",{},()=>[l(V,{type:_.buttonType,disabled:_.disabled||o.uploading},{default:r(()=>[l(v,{class:"el-icon--upload"},{default:r(()=>[l(w)]),_:1}),b(" "+O(_.buttonText),1)]),_:1},8,["type","disabled"])],!0)]),tip:r(()=>[oe(a.$slots,"tip",{},()=>[_.tip?(S(),T("div",Te,O(_.tip),1)):G("",!0)],!0)]),_:3},8,["action","accept","multiple","limit","disabled","show-file-list","on-change","on-exceed","on-error","before-upload","file-list"]),o.uploading?(S(),T("div",Le,[l(P,{percentage:o.uploadProgress,status:o.uploadStatus},null,8,["percentage","status"]),F("div",Re,O(o.progressText),1)])):G("",!0),_.showPreview&&o.fileUrl?(S(),T("div",Ee,[_.fileType==="image"?(S(),T("div",De,[F("img",{src:o.fileUrl,alt:"预览图片",onError:e[0]||(e[0]=(...N)=>o.handlePreviewError&&o.handlePreviewError(...N))},null,40,qe)])):_.fileType==="video"?(S(),T("div",Oe,[F("video",{controls:"",src:o.fileUrl,onError:e[1]||(e[1]=(...N)=>o.handlePreviewError&&o.handlePreviewError(...N))}," 您的浏览器不支持视频预览 ",40,ze),F("div",Ae,[l(I,{size:"small",type:"success"},{default:r(()=>e[2]||(e[2]=[b("视频已上传")])),_:1,__:[2]}),F("span",Be,O(o.fileName||"视频"),1)])])):(S(),T("div",Me,[l(x,{href:o.fileUrl,target:"_blank"},{default:r(()=>[b(O(o.fileName||"查看文件"),1)]),_:1},8,["href"])]))])):G("",!0)])}const re=$(xe,[["render",je],["__scopeId","data-v-1b5d16c8"]]),We=be({name:"CourseForm",components:{FileUpload:re,Plus:ae},props:{courseId:{type:[Number,String],default:null},isEdit:{type:Boolean,default:!1}},emits:["success","cancel"],setup(a,{emit:e}){const _=U(null),o=U(!1),g=K({id:null,courseName:"",courseIntro:"",courseOrder:1,courseAuthor:"",coverImage:"",videoUrl:"",status:1,remark:""}),f=K({uploading:!1,progress:0,status:""}),w=W(()=>f.status==="success"?"上传成功":f.status==="exception"?"上传失败":`上传中 ${f.progress}%`),v={courseName:[{required:!0,message:"请输入课程名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],courseIntro:[{required:!0,message:"请输入课程简介",trigger:"blur"}],courseOrder:[{required:!0,message:"请输入课程排序",trigger:"blur"}],courseAuthor:[{required:!0,message:"请输入课程作者",trigger:"blur"}],coverImage:[{required:!0,message:"请上传课程封面",trigger:"change"}],videoUrl:[{required:!0,message:"请上传课程视频",trigger:"change"},{validator:(u,p,c)=>{p&&p.trim()!==""?c():c(new Error("请上传课程视频"))},trigger:"change"}]},V=u=>{const p=u.type.startsWith("image/"),c=u.size/1024/1024<2;return p?c?!0:(m.error("图片大小不能超过 2MB!"),!1):(m.error("只能上传图片文件!"),!1)},h=u=>{u.code===200?(g.coverImage=u.data.url,m.success("图片上传成功")):m.error(u.message||"图片上传失败")},P=u=>{g.videoUrl=u.url,m.success("视频上传成功"),f.uploading=!1,f.progress=100,f.status="success",console.log("设置课程视频URL:",g.videoUrl),_.value&&_.value.validateField("videoUrl")},I=u=>{console.log("视频文件已选择:",u.name),f.uploading=!0,f.progress=0,f.status=""},x=u=>{console.log("视频上传进度:",u),f.progress=u,f.uploading=u<100},N=async()=>{if(a.isEdit&&a.courseId){o.value=!0;try{const u=await z.getCourseById(a.courseId);u.code===200&&u.data?Object.assign(g,u.data):m.error("获取课程详情失败")}catch(u){console.error("获取课程详情异常:",u),m.error("获取课程详情异常")}finally{o.value=!1}}};Z(()=>a.courseId,u=>{u&&a.isEdit&&N()},{immediate:!0});const y=U(null);return Z(()=>g.videoUrl,u=>{u&&y.value&&ee(()=>{_.value&&_.value.validateField("videoUrl")})}),{formRef:_,form:g,rules:v,loading:o,submitForm:async()=>{_.value&&await _.value.validate(async u=>{if(!u)return!1;if(g.videoUrl&&g.videoUrl.startsWith("http")){const p=g.videoUrl.split("/"),c=p[p.length-1];c&&(g.videoUrl=`/uploads/${c}`,console.log("提交前格式化URL为相对路径:",g.videoUrl))}o.value=!0;try{let p;a.isEdit?p=await z.updateCourse(a.courseId,g):p=await z.createCourse(g),p.code===200?(m.success(a.isEdit?"修改成功":"添加成功"),e("success")):m.error(p.msg||(a.isEdit?"修改失败":"添加失败"))}catch(p){console.error("提交表单异常:",p),m.error("操作异常，请稍后重试")}finally{o.value=!1}})},cancel:()=>{e("cancel")},beforeCoverUpload:V,handleCoverSuccess:h,handleVideoUploadSuccess:P,videoUpload:y,videoUploadStatus:f,videoUploadStatusText:w,handleVideoFileChange:I,handleVideoUploadProgress:x}}}),Qe={class:"course-form"},Je=["src"],Ge={key:0,class:"video-upload-progress"},He={class:"upload-status-text"};function Ke(a,e,_,o,g,f){const w=d("el-input"),v=d("el-form-item"),V=d("el-input-number"),h=d("Plus"),P=d("el-icon"),I=d("el-upload"),x=d("file-upload"),N=d("el-progress"),y=d("el-radio"),R=d("el-radio-group"),E=d("el-button"),u=d("el-form");return S(),T("div",Qe,[l(u,{ref:"formRef",model:a.form,rules:a.rules,"label-width":"100px","label-position":"right",disabled:a.loading},{default:r(()=>[l(v,{label:"课程名称",prop:"courseName"},{default:r(()=>[l(w,{modelValue:a.form.courseName,"onUpdate:modelValue":e[0]||(e[0]=p=>a.form.courseName=p),placeholder:"请输入课程名称"},null,8,["modelValue"])]),_:1}),l(v,{label:"课程简介",prop:"courseIntro"},{default:r(()=>[l(w,{modelValue:a.form.courseIntro,"onUpdate:modelValue":e[1]||(e[1]=p=>a.form.courseIntro=p),type:"textarea",rows:"4",placeholder:"请输入课程简介"},null,8,["modelValue"])]),_:1}),l(v,{label:"课程排序",prop:"courseOrder"},{default:r(()=>[l(V,{modelValue:a.form.courseOrder,"onUpdate:modelValue":e[2]||(e[2]=p=>a.form.courseOrder=p),min:1,max:999},null,8,["modelValue"])]),_:1}),l(v,{label:"课程作者",prop:"courseAuthor"},{default:r(()=>[l(w,{modelValue:a.form.courseAuthor,"onUpdate:modelValue":e[3]||(e[3]=p=>a.form.courseAuthor=p),placeholder:"请输入课程作者"},null,8,["modelValue"])]),_:1}),l(v,{label:"课程封面",prop:"coverImage"},{default:r(()=>[l(I,{class:"cover-uploader",action:"http://localhost:8080/api/upload/image","show-file-list":!1,"before-upload":a.beforeCoverUpload,"on-success":a.handleCoverSuccess,accept:"image/*"},{default:r(()=>[a.form.coverImage?(S(),T("img",{key:0,src:a.form.coverImage,class:"cover-image"},null,8,Je)):(S(),J(P,{key:1,class:"cover-icon"},{default:r(()=>[l(h)]),_:1}))]),_:1},8,["before-upload","on-success"])]),_:1}),l(v,{label:"课程视频",prop:"videoUrl"},{default:r(()=>[l(x,{modelValue:a.form.videoUrl,"onUpdate:modelValue":e[4]||(e[4]=p=>a.form.videoUrl=p),ref:"videoUpload","file-type":"video","button-text":"上传视频",tip:"支持 mp4 格式，大小不超过 50MB","max-size":50,"initial-file-url":a.form.videoUrl,"auto-upload":!0,onUploadSuccess:a.handleVideoUploadSuccess,onUploadProgress:a.handleVideoUploadProgress,onFileChange:a.handleVideoFileChange},null,8,["modelValue","initial-file-url","onUploadSuccess","onUploadProgress","onFileChange"]),a.videoUploadStatus.uploading?(S(),T("div",Ge,[l(N,{percentage:a.videoUploadStatus.progress,status:a.videoUploadStatus.status,"stroke-width":10,"show-text":!0},null,8,["percentage","status"]),F("div",He,O(a.videoUploadStatusText),1)])):G("",!0)]),_:1}),l(v,{label:"课程状态",prop:"status"},{default:r(()=>[l(R,{modelValue:a.form.status,"onUpdate:modelValue":e[5]||(e[5]=p=>a.form.status=p)},{default:r(()=>[l(y,{label:1},{default:r(()=>e[7]||(e[7]=[b("启用")])),_:1,__:[7]}),l(y,{label:0},{default:r(()=>e[8]||(e[8]=[b("禁用")])),_:1,__:[8]})]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"备注",prop:"remark"},{default:r(()=>[l(w,{modelValue:a.form.remark,"onUpdate:modelValue":e[6]||(e[6]=p=>a.form.remark=p),type:"textarea",rows:"2",placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1}),l(v,null,{default:r(()=>[l(E,{type:"primary",onClick:a.submitForm,loading:a.loading},{default:r(()=>e[9]||(e[9]=[b("确定")])),_:1,__:[9]},8,["onClick","loading"]),l(E,{onClick:a.cancel},{default:r(()=>e[10]||(e[10]=[b("取消")])),_:1,__:[10]},8,["onClick"])]),_:1})]),_:1},8,["model","rules","disabled"])])}const Xe=$(We,[["render",Ke],["__scopeId","data-v-fa47a28d"]]),Ye={name:"CourseManagement",components:{CourseForm:Xe,FileUpload:re,Search:ke,Plus:ae,Refresh:Ve,Download:Ce,Reading:we,View:Ue},setup(){const a=K({pageNum:1,pageSize:10,courseName:"",courseOrder:null,courseAuthor:"",status:null}),e=Ne(),_=U([]),o=U(0),g=U(!1),f=U(!1),w=U(!1),v=U(null),V=W(()=>w.value?"修改课程":"新增课程"),h=U(!1),P=U(!1),I=U([]),x=U(null),N=U(!1),y=U(!1),R=U(null),E=U(null),u=U(!1),p=W(()=>u.value?"修改章节":"添加章节"),c=K({id:null,courseId:null,chapterName:"",chapterOrder:1,description:"",videoUrl:"",duration:0}),C={chapterName:[{required:!0,message:"请输入章节名称",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],chapterOrder:[{required:!0,message:"请输入章节排序",trigger:"blur"}],videoUrl:[{required:!0,message:"请上传章节视频",trigger:"change"}]},n=K({uploading:!1,progress:0,status:""}),L=W(()=>n.status==="success"?"上传成功":n.status==="exception"?"上传失败":`上传中 ${n.progress}%`),k=async()=>{g.value=!0;try{const t=await z.getCourseList(a);t.code===200?(_.value=t.data.records||[],o.value=t.data.total||0):m.error(t.msg||"获取课程列表失败")}catch(t){console.error("获取课程列表异常:",t),m.error("获取课程列表异常")}finally{g.value=!1}},D=()=>{a.pageNum=1,k()},X=()=>{a.courseName="",a.courseOrder=null,a.courseAuthor="",a.status=null,D()},A=()=>{w.value=!1,v.value=null,f.value=!0},q=t=>{w.value=!0,v.value=t.id,f.value=!0},Y=async t=>{try{const i=await z.deleteCourse(t.id);i.code===200?(m.success("删除成功"),k()):m.error(i.msg||"删除失败")}catch(i){console.error("删除课程异常:",i),m.error("删除课程异常")}},Q=async()=>{try{Pe.confirm("确认导出所有课程数据吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{g.value=!0;try{const t="http://localhost:8080",i=new URLSearchParams;a.courseName&&i.append("courseName",a.courseName),a.courseAuthor&&i.append("courseAuthor",a.courseAuthor),a.status!==null&&i.append("status",a.status);const j=`${t}/api/courses/export?${i.toString()}`,H=document.createElement("a");H.href=j,H.setAttribute("download",`课程列表_${new Date().toLocaleDateString()}.xlsx`),document.body.appendChild(H),H.click(),document.body.removeChild(H),m.success("导出成功")}catch(t){console.error("导出课程异常:",t),m.error("导出课程异常")}finally{g.value=!1}})}catch(t){console.error("导出确认异常:",t)}},B=async t=>{x.value=t,h.value=!0,await s(t.id)},s=async t=>{if(t){P.value=!0;try{const i=await z.getCourseChapters(t);i.code===200?I.value=i.data||[]:m.error(i.msg||"获取章节列表失败")}catch(i){console.error("获取章节列表异常:",i),m.error("获取章节列表异常")}finally{P.value=!1}}},M=()=>{u.value=!1,Object.assign(c,{id:null,courseId:x.value.id,chapterName:"",chapterOrder:I.value.length+1,description:"",videoUrl:"",duration:0}),ee(()=>{E.value&&E.value.reset()}),N.value=!0},te=t=>{if(u.value=!0,Object.assign(c,{id:t.id,courseId:t.courseId,chapterName:t.chapterName,chapterOrder:t.chapterOrder,description:t.description,videoUrl:t.videoUrl,duration:t.duration}),console.log("编辑章节，原始视频URL:",t.videoUrl),c.videoUrl&&!c.videoUrl.startsWith("http")){const i="http://localhost:8080";c.videoUrl.startsWith("/")?c.videoUrl=`${i}${c.videoUrl}`:c.videoUrl=`${i}/${c.videoUrl}`,console.log("格式化后的视频URL:",c.videoUrl)}N.value=!0},se=async t=>{try{const i=await z.deleteChapter(t.courseId,t.id);i.code===200?(m.success("删除成功"),s(x.value.id)):m.error(i.msg||"删除失败")}catch(i){console.error("删除章节异常:",i),m.error("删除章节异常")}},ne=t=>{if(console.log("视频上传成功:",t),t&&t.url){let i=t.url;if(console.log("返回的原始视频URL:",i),i.match(/^https?:\/\//)){const j=i.substring(i.lastIndexOf("/")+1);j.match(/\d{8}_.*\.\w+$/)&&console.log("日期格式文件名:",j)}else i.startsWith("/")||(i="/"+i,console.log("添加前导斜杠:",i));c.videoUrl=i,console.log("最终设置的视频URL:",c.videoUrl),n.uploading=!1,n.progress=100,n.status="success",R.value&&R.value.validateField("videoUrl")}},ie=t=>{console.log("视频文件已选择:",t.name),n.uploading=!0,n.progress=0,n.status=""},de=t=>{console.log("视频上传进度:",t),n.progress=t,n.uploading=t<100},ue=async()=>{R.value&&await R.value.validate(async t=>{if(!t)return!1;if(n.uploading&&n.progress<100)return m.warning("请等待视频上传完成"),!1;if(c.videoUrl&&c.videoUrl.startsWith("http")){const i=c.videoUrl.split("/"),j=i[i.length-1];j&&(c.videoUrl=`/uploads/${j}`,console.log("提交前格式化URL为相对路径:",c.videoUrl))}y.value=!0;try{console.log("准备提交章节表单:",JSON.stringify(c));let i;u.value?i=await z.updateChapter(c.courseId,c.id,c):i=await z.createChapter(c.courseId,c),i.code===200?(m.success(u.value?"修改成功":"添加成功"),N.value=!1,s(x.value.id)):m.error(i.msg||(u.value?"修改失败":"添加失败"))}catch(i){console.error("提交章节表单异常:",i),m.error("操作异常，请稍后重试")}finally{y.value=!1}})},ce=()=>{f.value=!1,k()},pe=t=>{a.pageSize=t,k()},me=t=>{a.pageNum=t,k()},fe=t=>{e.push({name:"CourseDetail",params:{id:t.courseId},query:{chapterId:t.id}})},ge=()=>{e.push({name:"CourseReview"})},ve=t=>({0:"审核通过",1:"待审核",2:"审核不通过"})[t]||"未知状态",he=t=>({0:"success",1:"warning",2:"danger"})[t]||"info";return Fe(()=>{k()}),{queryParams:a,courseList:_,total:o,loading:g,dialogVisible:f,isEdit:w,selectedCourseId:v,formTitle:V,handleSearch:D,resetQuery:X,handleAdd:A,handleUpdate:q,handleDelete:Y,handleExport:Q,handleViewChapters:B,handleFormSuccess:ce,handleSizeChange:pe,handleCurrentChange:me,chapterDialogVisible:h,chapterLoading:P,chapterList:I,currentCourse:x,handleAddChapter:M,handleEditChapter:te,handleDeleteChapter:se,chapterFormDialogVisible:N,chapterFormLoading:y,chapterFormRef:R,chapterForm:c,isEditChapter:u,chapterRules:C,chapterFormTitle:p,submitChapterForm:ue,videoUpload:E,handleVideoUploadSuccess:ne,router:e,handleViewChapter:fe,navigateToCourseReview:ge,getReviewStatusType:he,getReviewStatusText:ve,videoUploadStatus:n,videoUploadStatusText:L,handleVideoFileChange:ie,handleVideoUploadProgress:de}}},Ze={class:"course-management"},$e={class:"page-header"},eo={class:"header-content"},oo={class:"page-title"},lo={class:"search-container"},ao={class:"action-container"},ro={key:1},to={class:"pagination-container"},so={key:0,class:"chapter-header"},no={class:"chapter-actions"},io={key:0,class:"video-upload-progress"},uo={class:"upload-status-text"};function co(a,e,_,o,g,f){const w=d("Reading"),v=d("el-icon"),V=d("el-input"),h=d("el-form-item"),P=d("el-input-number"),I=d("el-option"),x=d("el-select"),N=d("Search"),y=d("el-button"),R=d("Refresh"),E=d("el-form"),u=d("Plus"),p=d("Download"),c=d("View"),C=d("el-table-column"),n=d("el-image"),L=d("el-tag"),k=d("el-popconfirm"),D=d("el-table"),X=d("el-pagination"),A=d("course-form"),q=d("el-dialog"),Y=d("file-upload"),Q=d("el-progress"),B=Se("loading");return S(),T("div",Ze,[F("div",$e,[F("div",eo,[F("h1",oo,[l(v,null,{default:r(()=>[l(w)]),_:1}),e[16]||(e[16]=b(" 课程管理 "))]),e[17]||(e[17]=F("p",{class:"page-description"},"管理系统课程内容、分类和状态",-1))])]),F("div",lo,[l(E,{inline:!0,model:o.queryParams,class:"search-form"},{default:r(()=>[l(h,{label:"课程名称"},{default:r(()=>[l(V,{modelValue:o.queryParams.courseName,"onUpdate:modelValue":e[0]||(e[0]=s=>o.queryParams.courseName=s),placeholder:"请输入课程名称",clearable:""},null,8,["modelValue"])]),_:1}),l(h,{label:"课程排序"},{default:r(()=>[l(P,{modelValue:o.queryParams.courseOrder,"onUpdate:modelValue":e[1]||(e[1]=s=>o.queryParams.courseOrder=s),placeholder:"请输入课程排序",min:1,clearable:""},null,8,["modelValue"])]),_:1}),l(h,{label:"课程作者"},{default:r(()=>[l(V,{modelValue:o.queryParams.courseAuthor,"onUpdate:modelValue":e[2]||(e[2]=s=>o.queryParams.courseAuthor=s),placeholder:"请输入课程作者",clearable:""},null,8,["modelValue"])]),_:1}),l(h,{label:"状态"},{default:r(()=>[l(x,{modelValue:o.queryParams.status,"onUpdate:modelValue":e[3]||(e[3]=s=>o.queryParams.status=s),placeholder:"请选择状态",clearable:""},{default:r(()=>[l(I,{label:"启用",value:1}),l(I,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),l(h,null,{default:r(()=>[l(y,{type:"primary",onClick:o.handleSearch},{default:r(()=>[l(v,null,{default:r(()=>[l(N)]),_:1}),e[18]||(e[18]=b("搜索 "))]),_:1,__:[18]},8,["onClick"]),l(y,{onClick:o.resetQuery},{default:r(()=>[l(v,null,{default:r(()=>[l(R)]),_:1}),e[19]||(e[19]=b("重置 "))]),_:1,__:[19]},8,["onClick"])]),_:1})]),_:1},8,["model"])]),F("div",ao,[l(y,{type:"primary",onClick:o.handleAdd},{default:r(()=>[l(v,null,{default:r(()=>[l(u)]),_:1}),e[20]||(e[20]=b("新增 "))]),_:1,__:[20]},8,["onClick"]),l(y,{type:"success",onClick:o.handleExport},{default:r(()=>[l(v,null,{default:r(()=>[l(p)]),_:1}),e[21]||(e[21]=b("导出 "))]),_:1,__:[21]},8,["onClick"]),l(y,{type:"warning",onClick:o.navigateToCourseReview},{default:r(()=>[l(v,null,{default:r(()=>[l(c)]),_:1}),e[22]||(e[22]=b("课程审核管理 "))]),_:1,__:[22]},8,["onClick"])]),le((S(),J(D,{data:o.courseList,border:"",style:{width:"100%"},"row-key":"id"},{default:r(()=>[l(C,{prop:"id",label:"ID",width:"80"}),l(C,{prop:"courseName",label:"课程名称","min-width":"150","show-overflow-tooltip":""}),l(C,{label:"课程封面",width:"100"},{default:r(s=>[s.row.coverImage?(S(),J(n,{key:0,src:s.row.coverImage,"preview-src-list":[s.row.coverImage],"preview-teleported":!0,"z-index":3e3,fit:"cover",style:{width:"60px",height:"40px","border-radius":"4px",cursor:"pointer"}},null,8,["src","preview-src-list"])):(S(),T("span",ro,"无封面"))]),_:1}),l(C,{prop:"courseAuthor",label:"课程作者",width:"120","show-overflow-tooltip":""}),l(C,{prop:"courseOrder",label:"排序",width:"80",align:"center"}),l(C,{prop:"viewCount",label:"浏览次数",width:"100",align:"center"}),l(C,{prop:"status",label:"状态",width:"80",align:"center"},{default:r(s=>[l(L,{type:s.row.status===1?"success":"info"},{default:r(()=>[b(O(s.row.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(C,{prop:"remark",label:"审核状态",width:"100",align:"center"},{default:r(s=>[l(L,{type:o.getReviewStatusType(s.row.remark)},{default:r(()=>[b(O(o.getReviewStatusText(s.row.remark)),1)]),_:2},1032,["type"])]),_:1}),l(C,{prop:"createTime",label:"创建时间",width:"160","show-overflow-tooltip":""}),l(C,{label:"操作",width:"200",align:"center",fixed:"right"},{default:r(s=>[l(y,{type:"primary",link:"",onClick:M=>o.handleUpdate(s.row)},{default:r(()=>e[23]||(e[23]=[b("修改")])),_:2,__:[23]},1032,["onClick"]),l(y,{type:"primary",link:"",onClick:M=>o.handleViewChapters(s.row)},{default:r(()=>e[24]||(e[24]=[b("章节")])),_:2,__:[24]},1032,["onClick"]),l(k,{title:"确定要删除该课程吗？",onConfirm:M=>o.handleDelete(s.row)},{reference:r(()=>[l(y,{type:"danger",link:""},{default:r(()=>e[25]||(e[25]=[b("删除")])),_:1,__:[25]})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[B,o.loading]]),F("div",to,[l(X,{"current-page":o.queryParams.pageNum,"onUpdate:currentPage":e[4]||(e[4]=s=>o.queryParams.pageNum=s),"page-size":o.queryParams.pageSize,"onUpdate:pageSize":e[5]||(e[5]=s=>o.queryParams.pageSize=s),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:o.total,onSizeChange:o.handleSizeChange,onCurrentChange:o.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),l(q,{title:o.formTitle,modelValue:o.dialogVisible,"onUpdate:modelValue":e[7]||(e[7]=s=>o.dialogVisible=s),width:"700px","close-on-click-modal":!1,"destroy-on-close":""},{default:r(()=>[l(A,{"course-id":o.selectedCourseId,"is-edit":o.isEdit,onSuccess:o.handleFormSuccess,onCancel:e[6]||(e[6]=s=>o.dialogVisible=!1)},null,8,["course-id","is-edit","onSuccess"])]),_:1},8,["title","modelValue"]),l(q,{title:"章节管理",modelValue:o.chapterDialogVisible,"onUpdate:modelValue":e[15]||(e[15]=s=>o.chapterDialogVisible=s),width:"900px","close-on-click-modal":!1,"destroy-on-close":""},{default:r(()=>[o.currentCourse?(S(),T("div",so,[F("h3",null,O(o.currentCourse.courseName),1),F("p",null,O(o.currentCourse.courseIntro),1)])):G("",!0),F("div",no,[l(y,{type:"primary",onClick:o.handleAddChapter},{default:r(()=>[l(v,null,{default:r(()=>[l(u)]),_:1}),e[26]||(e[26]=b("添加章节 "))]),_:1,__:[26]},8,["onClick"])]),le((S(),J(D,{data:o.chapterList,border:"",style:{width:"100%"},"row-key":"id"},{default:r(()=>[l(C,{prop:"id",label:"ID",width:"80"}),l(C,{prop:"chapterName",label:"章节名称","min-width":"150","show-overflow-tooltip":""}),l(C,{prop:"chapterOrder",label:"排序",width:"80",align:"center"}),l(C,{prop:"duration",label:"时长(秒)",width:"100",align:"center"}),l(C,{label:"视频",width:"100",align:"center"},{default:r(s=>[s.row.videoUrl?(S(),J(L,{key:0,type:"success"},{default:r(()=>e[27]||(e[27]=[b("已上传")])),_:1,__:[27]})):(S(),J(L,{key:1,type:"info"},{default:r(()=>e[28]||(e[28]=[b("未上传")])),_:1,__:[28]}))]),_:1}),l(C,{prop:"createTime",label:"创建时间",width:"160","show-overflow-tooltip":""}),l(C,{label:"操作",width:"200",align:"center",fixed:"right"},{default:r(s=>[l(y,{type:"success",link:"",onClick:M=>o.handleViewChapter(s.row)},{default:r(()=>e[29]||(e[29]=[b("观看")])),_:2,__:[29]},1032,["onClick"]),l(y,{type:"primary",link:"",onClick:M=>o.handleEditChapter(s.row)},{default:r(()=>e[30]||(e[30]=[b("修改")])),_:2,__:[30]},1032,["onClick"]),l(k,{title:"确定要删除该章节吗？",onConfirm:M=>o.handleDeleteChapter(s.row)},{reference:r(()=>[l(y,{type:"danger",link:""},{default:r(()=>e[31]||(e[31]=[b("删除")])),_:1,__:[31]})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[B,o.chapterLoading]]),l(q,{title:o.chapterFormTitle,modelValue:o.chapterFormDialogVisible,"onUpdate:modelValue":e[14]||(e[14]=s=>o.chapterFormDialogVisible=s),width:"600px","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":""},{default:r(()=>[l(E,{ref:"chapterFormRef",model:o.chapterForm,rules:o.chapterRules,"label-width":"100px","label-position":"right",disabled:o.chapterFormLoading},{default:r(()=>[l(h,{label:"章节名称",prop:"chapterName"},{default:r(()=>[l(V,{modelValue:o.chapterForm.chapterName,"onUpdate:modelValue":e[8]||(e[8]=s=>o.chapterForm.chapterName=s),placeholder:"请输入章节名称"},null,8,["modelValue"])]),_:1}),l(h,{label:"章节排序",prop:"chapterOrder"},{default:r(()=>[l(P,{modelValue:o.chapterForm.chapterOrder,"onUpdate:modelValue":e[9]||(e[9]=s=>o.chapterForm.chapterOrder=s),min:1,max:999},null,8,["modelValue"])]),_:1}),l(h,{label:"章节描述",prop:"description"},{default:r(()=>[l(V,{modelValue:o.chapterForm.description,"onUpdate:modelValue":e[10]||(e[10]=s=>o.chapterForm.description=s),type:"textarea",rows:"3",placeholder:"请输入章节描述"},null,8,["modelValue"])]),_:1}),l(h,{label:"视频",prop:"videoUrl"},{default:r(()=>[l(Y,{modelValue:o.chapterForm.videoUrl,"onUpdate:modelValue":e[11]||(e[11]=s=>o.chapterForm.videoUrl=s),ref:"videoUpload","file-type":"video","button-text":"上传视频",tip:"支持 mp4 格式，大小不超过 50MB","max-size":50,"auto-upload":!0,"initial-file-url":o.chapterForm.videoUrl,onUploadSuccess:o.handleVideoUploadSuccess,onUploadProgress:o.handleVideoUploadProgress,onFileChange:o.handleVideoFileChange},null,8,["modelValue","initial-file-url","onUploadSuccess","onUploadProgress","onFileChange"]),o.videoUploadStatus.uploading?(S(),T("div",io,[l(Q,{percentage:o.videoUploadStatus.progress,status:o.videoUploadStatus.status,"stroke-width":10,"show-text":!0},null,8,["percentage","status"]),F("div",uo,O(o.videoUploadStatusText),1)])):G("",!0)]),_:1}),l(h,{label:"视频时长",prop:"duration"},{default:r(()=>[l(P,{modelValue:o.chapterForm.duration,"onUpdate:modelValue":e[12]||(e[12]=s=>o.chapterForm.duration=s),min:0,placeholder:"视频时长(秒)"},null,8,["modelValue"])]),_:1}),l(h,null,{default:r(()=>[l(y,{type:"primary",onClick:o.submitChapterForm,loading:o.chapterFormLoading},{default:r(()=>e[32]||(e[32]=[b("确定")])),_:1,__:[32]},8,["onClick","loading"]),l(y,{onClick:e[13]||(e[13]=s=>o.chapterFormDialogVisible=!1)},{default:r(()=>e[33]||(e[33]=[b("取消")])),_:1,__:[33]})]),_:1})]),_:1},8,["model","rules","disabled"])]),_:1},8,["title","modelValue"])]),_:1},8,["modelValue"])])}const fo=$(Ye,[["render",co],["__scopeId","data-v-f3f2dbda"]]);export{fo as default};
