import{X as C,_ as q,c as f,e as P,b as l,A as s,p as i,z as m,g as z,W as A,m as w,C as x,f as o,t as d,L as H,E as g,k as p,H as W}from"./index-Ntw4s37F.js";function X(){return C({url:"/api/tenants/all",method:"get"})}function j(a){return C({url:`/api/departments/by-tenant/${a}`,method:"get"})}function G(a){return C({url:"/api/departments",method:"post",data:a})}function J(a,e){return C({url:`/api/departments/${a}`,method:"put",data:e})}function K(a){return C({url:`/api/departments/${a}`,method:"delete"})}const O={name:"DepartmentManagement",data(){return{deptRules:{deptCode:[{required:!0,message:"请输入部门编码",trigger:"blur"}],deptName:[{required:!0,message:"请输入部门名称",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},filters:{company:"",department:"",deptStatus:""},current:{type:"",data:null},deptDialog:{visible:!1,title:"",form:{deptCode:"",deptName:"",phone:"",email:"",address:"",status:1,remark:"",parentId:null,tenantId:null},isEdit:!1},isSearchResult:!1,searchResultList:[],companies:[],treeLoading:!1,tableLoading:!1}},computed:{treeData(){return this.companies.map(a=>{var e;return{id:a.id,label:a.tenantName,children:((e=a.departments)==null?void 0:e.map(r=>({id:r.id,label:r.deptName,type:"department",data:r})))||[],type:"company",data:a}})},treeProps(){return{children:"children",label:"label"}}},created(){this.loadTenants()},methods:{getRootDeptId(a){const e=this.companies.find(r=>r.id===a);if(e&&e.departments){const r=e.departments.find(u=>u.parentId===null);return r?r.id:null}return null},async loadTenants(){this.treeLoading=!0;try{const a=await X();a.code===200&&(this.companies=a.data,this.companies.length>0&&!this.companies[0].departments&&await this.loadDeptsForTenant(this.companies[0].id))}catch(a){console.error("加载企业数据失败:",a),g.error("加载企业数据失败")}finally{this.treeLoading=!1}},async loadDeptsForTenant(a){this.tableLoading=!0;try{const e=await j(a);if(e.code===200){const r=this.companies.find(u=>u.id===a);r&&(r.departments=e.data)}}catch(e){console.error("加载部门数据失败:",e),g.error("加载部门数据失败")}finally{this.tableLoading=!1}},async handleSearch(){const{company:a,department:e,deptStatus:r}=this.filters;if(!a&&!e&&!r){g.warning("请输入要查找的公司或部门信息");return}this.searchResultList=[];try{this.companies.length===0&&await this.loadTenants(),this.companies.forEach(u=>{a&&!u.tenantName.toLowerCase().includes(a.toLowerCase())||u.departments&&u.departments.forEach(t=>{e&&!t.deptName.toLowerCase().includes(e.toLowerCase())||r&&(t.status===1?"正常":"停用")!==r||this.searchResultList.push({...t,companyName:u.tenantName,companyId:u.id})})}),this.searchResultList.length>0?(this.isSearchResult=!0,this.current.type="",this.current.data=null,g.success(`找到 ${this.searchResultList.length} 个部门`)):g.warning("未找到匹配的部门")}catch(u){console.error("搜索失败:",u),g.error("搜索失败")}},resetFilters(){this.filters.company="",this.filters.department="",this.filters.deptStatus="",this.isSearchResult=!1,!this.current.type&&this.companies.length>0&&(this.current.type="company",this.current.data=this.companies[0])},exitSearch(){this.isSearchResult=!1},viewDeptDetail(a){var r;const e=this.companies.find(u=>u.id===a.companyId);if(e){const u=(r=e.departments)==null?void 0:r.find(t=>t.id===a.id);u&&(this.current.type="department",this.current.data=u,this.isSearchResult=!1)}},async handleTreeNodeClick(a){a.type==="company"?(this.current.type="company",this.current.data=a.data,a.data.departments||await this.loadDeptsForTenant(a.data.id)):a.type==="department"&&(this.current.type="department",this.current.data=a.data),this.isSearchResult=!1},openDeptDialog(a=null){if(this.deptDialog.isEdit=!!a,this.deptDialog.title=a?"修改部门信息":"添加新部门",this.deptDialog.visible=!0,a)this.deptDialog.form={id:a.id,deptCode:a.deptCode,deptName:a.deptName,phone:a.phone,email:a.email,address:a.address,status:a.status,remark:a.remark,tenantId:a.tenantId,parentId:a.parentId};else{const e=this.getRootDeptId(this.current.data.id);this.deptDialog.form={deptCode:"",deptName:"",phone:"",email:"",address:"",status:1,remark:"",tenantId:this.current.data.id,parentId:e||null}}this.$nextTick(()=>{this.$refs.deptForm&&this.$refs.deptForm.clearValidate()})},async saveDept(){this.$refs.deptForm.validate(async a=>{if(a)try{let e;this.deptDialog.isEdit?e=await J(this.deptDialog.form.id,this.deptDialog.form):e=await G(this.deptDialog.form),e.code===200?(g.success(this.deptDialog.isEdit?"部门信息更新成功":"部门添加成功"),await this.loadDeptsForTenant(this.deptDialog.form.tenantId),this.deptDialog.visible=!1):g.error(e.message||"操作失败")}catch(e){console.error("保存部门失败:",e),e.response&&e.response.data?g.error(e.response.data.message||"操作失败"):g.error("操作失败，请检查数据格式")}})},async deleteDept(a){try{await H.confirm(`确定要删除 "${a.deptName}" 部门吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await K(a.id);e.code===200?(g.success("部门已删除"),await this.loadDeptsForTenant(a.tenantId),this.current.type==="department"&&this.current.data.id===a.id&&(this.current.type="",this.current.data=null)):g.error(e.message||"删除失败")}catch{}},getCompanyName(a){const e=this.companies.find(r=>r.id===a.tenantId);return e?e.tenantName:"未知公司"}}},Q={class:"department-management"},Y={class:"search-container"},Z={class:"form-actions"},$={class:"main-container"},ee={class:"tree-container"},te={class:"tree-content"},le={class:"custom-tree-node"},se={class:"content-container"},ae={class:"content-header"},ie={key:0},ne={key:1},oe={key:2},re={key:3},de={key:4},pe={key:5,class:"action-buttons"},ue={class:"content-body"},me={key:0,class:"empty-state"},ce={key:1},fe={class:"dept-list-header"},ge={class:"page-description"},_e={style:{display:"flex","align-items":"center"}},he={key:2},ye={class:"dept-detail-card"},ve={class:"dept-header"},be={class:"dept-info"},De={class:"dept-name"},ke={class:"dept-path"},we={class:"dept-details"},Ce={class:"detail-section"},Ve={class:"detail-grid"},Ne={class:"detail-item"},xe={class:"detail-value"},Re={class:"detail-item"},Se={class:"detail-value"},Te={key:1},Le={class:"detail-item"},Ie={class:"detail-value"},ze={key:1},Ue={class:"detail-item"},Fe={class:"detail-value"},Ee={class:"detail-item"},Be={class:"detail-value"},Me={class:"detail-section"},qe={class:"dept-description"},Pe={key:3},Ae={class:"dept-list-header"},He={class:"page-description"},We={style:{display:"flex","align-items":"center"}},Xe={style:{display:"flex","align-items":"center"}};function je(a,e,r,u,t,c){const y=m("el-input"),h=m("el-form-item"),R=m("el-option"),U=m("el-select"),v=m("el-button"),S=m("el-form"),F=m("el-tree"),_=m("el-table-column"),N=m("el-tag"),b=m("el-link"),T=m("el-table"),E=m("el-divider"),D=m("el-col"),V=m("el-row"),L=m("el-radio"),B=m("el-radio-group"),M=m("el-dialog"),I=A("loading");return p(),f("div",Q,[e[51]||(e[51]=P('<div class="tenant-management" data-v-061ac746><div class="page-header" data-v-061ac746><div class="header-content" data-v-061ac746><h1 class="page-title" data-v-061ac746><i class="el-icon-office-building" data-v-061ac746></i> 部门管理 </h1><p class="page-description" data-v-061ac746>管理系统租户和多租户配置</p></div></div></div>',1)),l("div",Y,[e[18]||(e[18]=l("div",{class:"search-title"},[l("i",{class:"el-icon-search"}),l("span",null,"部门搜索")],-1)),s(S,{model:t.filters,class:"search-form"},{default:i(()=>[s(h,{label:"公司名称"},{default:i(()=>[s(y,{modelValue:t.filters.company,"onUpdate:modelValue":e[0]||(e[0]=n=>t.filters.company=n),placeholder:"请输入公司名称",clearable:""},null,8,["modelValue"])]),_:1}),s(h,{label:"部门名称"},{default:i(()=>[s(y,{modelValue:t.filters.department,"onUpdate:modelValue":e[1]||(e[1]=n=>t.filters.department=n),placeholder:"请输入部门名称",clearable:""},null,8,["modelValue"])]),_:1}),s(h,{label:"部门状态"},{default:i(()=>[s(U,{modelValue:t.filters.deptStatus,"onUpdate:modelValue":e[2]||(e[2]=n=>t.filters.deptStatus=n),placeholder:"请选择状态",clearable:""},{default:i(()=>[s(R,{label:"正常",value:"正常"}),s(R,{label:"停用",value:"停用"})]),_:1},8,["modelValue"])]),_:1}),l("div",Z,[s(v,{type:"primary",icon:"el-icon-search",onClick:c.handleSearch,class:"search-btn",size:"medium"},{default:i(()=>e[16]||(e[16]=[o("查找")])),_:1,__:[16]},8,["onClick"]),s(v,{type:"default",onClick:c.resetFilters,class:"reset-btn",size:"medium"},{default:i(()=>e[17]||(e[17]=[o("重置")])),_:1,__:[17]},8,["onClick"])])]),_:1},8,["model"])]),l("div",$,[l("div",ee,[e[19]||(e[19]=l("div",{class:"tree-header"},[l("i",{class:"el-icon-s-fold"}),l("span",null,"组织架构")],-1)),l("div",te,[z((p(),w(F,{data:c.treeData,props:c.treeProps,"node-key":"id","highlight-current":"","expand-on-click-node":!1,onNodeClick:c.handleTreeNodeClick},{default:i(({node:n,data:k})=>[l("div",le,[l("i",{class:W(k.type==="company"?"el-icon-office-building company-node":"el-icon-s-management department-node")},null,2),l("span",null,d(n.label),1)])]),_:1},8,["data","props","onNodeClick"])),[[I,t.treeLoading]])])]),l("div",se,[l("div",ae,[t.current.type==="company"?(p(),f("h2",ie,[e[20]||(e[20]=l("i",{class:"el-icon-office-building"},null,-1)),o(" "+d(t.current.data.tenantName)+" — 部门管理 ",1)])):t.current.type==="department"?(p(),f("h2",ne,[e[21]||(e[21]=l("i",{class:"el-icon-s-management"},null,-1)),o(" "+d(t.current.data.deptName)+" 部门详情 ",1)])):t.isSearchResult?(p(),f("h2",oe,e[22]||(e[22]=[l("i",{class:"el-icon-search"},null,-1),o(" 搜索结果 ")]))):(p(),f("h2",re,e[23]||(e[23]=[l("i",{class:"el-icon-info"},null,-1),o(" 部门信息 ")]))),t.current.type==="company"?(p(),f("div",de,[s(v,{type:"primary",icon:"el-icon-plus",onClick:e[3]||(e[3]=n=>c.openDeptDialog()),class:"add-dept-btn",size:"medium"},{default:i(()=>e[24]||(e[24]=[o("添加部门")])),_:1,__:[24]})])):t.current.type==="department"?(p(),f("div",pe,[s(v,{type:"primary",icon:"el-icon-edit",onClick:e[4]||(e[4]=n=>c.openDeptDialog(t.current.data)),class:"edit-btn",size:"medium"},{default:i(()=>e[25]||(e[25]=[o("修改部门")])),_:1,__:[25]}),s(v,{type:"danger",icon:"el-icon-delete",onClick:e[5]||(e[5]=n=>c.deleteDept(t.current.data)),class:"delete-btn",size:"medium"},{default:i(()=>e[26]||(e[26]=[o("删除部门")])),_:1,__:[26]})])):t.isSearchResult?(p(),w(v,{key:6,type:"default",onClick:c.exitSearch,size:"medium"},{default:i(()=>e[27]||(e[27]=[o("返回")])),_:1,__:[27]},8,["onClick"])):x("",!0)]),l("div",ue,[!t.current.type&&!t.isSearchResult?(p(),f("div",me,e[28]||(e[28]=[l("i",{class:"el-icon-office-building empty-icon"},null,-1),l("h3",{class:"empty-title"},"请选择公司或部门",-1),l("p",{class:"empty-desc"},[o("从左侧选择公司查看其部门列表，或选择部门查看详细信息"),l("br"),o("您也可以使用搜索功能查找特定部门")],-1)]))):t.current.type==="company"?(p(),f("div",ce,[l("div",fe,[l("div",null,[e[29]||(e[29]=l("h3",null,"部门列表",-1)),l("p",ge,"共 "+d(t.current.data.departments?t.current.data.departments.length:0)+" 个部门",1)])]),t.current.data.departments?z((p(),w(T,{key:0,data:t.current.data.departments,class:"dept-table"},{default:i(()=>[s(_,{prop:"deptName",label:"部门名称",width:"220"},{default:i(n=>[l("div",_e,[e[30]||(e[30]=l("i",{class:"el-icon-s-management",style:{color:"#0d9e0d","margin-right":"8px"}},null,-1)),l("span",null,d(n.row.deptName),1)])]),_:1}),s(_,{prop:"deptCode",label:"部门编码",width:"180"}),s(_,{prop:"status",label:"状态",width:"120"},{default:i(n=>[s(N,{type:n.row.status===1?"success":"danger"},{default:i(()=>[o(d(n.row.status===1?"正常":"停用"),1)]),_:2},1032,["type"])]),_:1}),s(_,{prop:"createTime",label:"创建时间",width:"180"}),s(_,{label:"操作",width:"180",align:"right"},{default:i(n=>[s(b,{type:"primary",onClick:k=>c.openDeptDialog(n.row),underline:!1,style:{"margin-right":"15px"}},{default:i(()=>e[31]||(e[31]=[o("修改")])),_:2,__:[31]},1032,["onClick"]),s(b,{type:"danger",onClick:k=>c.deleteDept(n.row),underline:!1},{default:i(()=>e[32]||(e[32]=[o("删除")])),_:2,__:[32]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[I,t.tableLoading]]):x("",!0)])):t.current.type==="department"?(p(),f("div",he,[l("div",ye,[l("div",ve,[l("div",be,[l("div",De,[e[33]||(e[33]=l("i",{class:"el-icon-s-management"},null,-1)),l("h3",null,d(t.current.data.deptName),1)]),s(N,{type:t.current.data.status===1?"success":"danger",class:"status-tag"},{default:i(()=>[o(d(t.current.data.status===1?"正常":"停用"),1)]),_:1},8,["type"])]),l("p",ke,[e[34]||(e[34]=l("i",{class:"el-icon-office-building"},null,-1)),o(" "+d(c.getCompanyName(t.current.data)),1)])]),s(E),l("div",we,[l("div",Ce,[e[40]||(e[40]=l("h4",{class:"section-title"},"基本信息",-1)),l("div",Ve,[l("div",Ne,[e[35]||(e[35]=l("span",{class:"detail-label"},"部门编码：",-1)),l("span",xe,d(t.current.data.deptCode),1)]),l("div",Re,[e[36]||(e[36]=l("span",{class:"detail-label"},"联系电话：",-1)),l("span",Se,[t.current.data.phone?(p(),w(b,{key:0,type:"primary",href:`tel:${t.current.data.phone}`},{default:i(()=>[o(d(t.current.data.phone),1)]),_:1},8,["href"])):(p(),f("span",Te,"未设置"))])]),l("div",Le,[e[37]||(e[37]=l("span",{class:"detail-label"},"邮箱：",-1)),l("span",Ie,[t.current.data.email?(p(),w(b,{key:0,type:"primary",href:`mailto:${t.current.data.email}`},{default:i(()=>[o(d(t.current.data.email),1)]),_:1},8,["href"])):(p(),f("span",ze,"未设置"))])]),l("div",Ue,[e[38]||(e[38]=l("span",{class:"detail-label"},"地址：",-1)),l("span",Fe,d(t.current.data.address||"未设置"),1)]),l("div",Ee,[e[39]||(e[39]=l("span",{class:"detail-label"},"创建时间：",-1)),l("span",Be,d(t.current.data.createTime),1)])])]),l("div",Me,[e[41]||(e[41]=l("h4",{class:"section-title"},"部门描述",-1)),l("p",qe,d(t.current.data.remark||"暂无部门描述信息"),1)])])])])):t.isSearchResult?(p(),f("div",Pe,[l("div",Ae,[l("div",null,[e[42]||(e[42]=l("h3",null,"搜索结果",-1)),l("p",He,"找到 "+d(t.searchResultList.length)+" 个匹配的部门",1)])]),s(T,{data:t.searchResultList},{default:i(()=>[s(_,{prop:"companyName",label:"公司名称",width:"220"},{default:i(n=>[l("div",We,[e[43]||(e[43]=l("i",{class:"el-icon-office-building",style:{color:"#1a73e8","margin-right":"8px"}},null,-1)),l("span",null,d(n.row.companyName),1)])]),_:1}),s(_,{prop:"deptName",label:"部门名称",width:"220"},{default:i(n=>[l("div",Xe,[e[44]||(e[44]=l("i",{class:"el-icon-s-management",style:{color:"#0d9e0d","margin-right":"8px"}},null,-1)),l("span",null,d(n.row.deptName),1)])]),_:1}),s(_,{prop:"deptCode",label:"部门编码",width:"180"}),s(_,{prop:"status",label:"状态",width:"120"},{default:i(n=>[s(N,{type:n.row.status===1?"success":"danger"},{default:i(()=>[o(d(n.row.status===1?"正常":"停用"),1)]),_:2},1032,["type"])]),_:1}),s(_,{prop:"createTime",label:"创建时间",width:"180"}),s(_,{label:"操作",width:"180",align:"right"},{default:i(n=>[s(b,{type:"primary",onClick:k=>c.viewDeptDetail(n.row),underline:!1,style:{"margin-right":"15px"}},{default:i(()=>e[45]||(e[45]=[o("详情")])),_:2,__:[45]},1032,["onClick"]),s(b,{type:"danger",onClick:k=>c.deleteDept(n.row),underline:!1},{default:i(()=>e[46]||(e[46]=[o("删除")])),_:2,__:[46]},1032,["onClick"])]),_:1})]),_:1},8,["data"])])):x("",!0)])])]),s(M,{title:t.deptDialog.title,modelValue:t.deptDialog.visible,"onUpdate:modelValue":e[15]||(e[15]=n=>t.deptDialog.visible=n),width:"600px","close-on-click-modal":!1,"custom-class":"dept-dialog"},{footer:i(()=>[s(v,{onClick:e[14]||(e[14]=n=>t.deptDialog.visible=!1),size:"medium",class:"dialog-btn"},{default:i(()=>e[49]||(e[49]=[o("取消")])),_:1,__:[49]}),s(v,{type:"primary",onClick:c.saveDept,size:"medium",class:"dialog-btn"},{default:i(()=>e[50]||(e[50]=[o("确定")])),_:1,__:[50]},8,["onClick"])]),default:i(()=>[s(S,{model:t.deptDialog.form,"label-width":"100px",rules:t.deptRules,ref:"deptForm"},{default:i(()=>[s(y,{type:"hidden",modelValue:t.deptDialog.form.parentId,"onUpdate:modelValue":e[6]||(e[6]=n=>t.deptDialog.form.parentId=n)},null,8,["modelValue"]),s(V,{gutter:20},{default:i(()=>[s(D,{span:12},{default:i(()=>[s(h,{label:"部门编码",prop:"deptCode"},{default:i(()=>[s(y,{modelValue:t.deptDialog.form.deptCode,"onUpdate:modelValue":e[7]||(e[7]=n=>t.deptDialog.form.deptCode=n),placeholder:"请输入部门编码",size:"medium"},null,8,["modelValue"])]),_:1})]),_:1}),s(D,{span:12},{default:i(()=>[s(h,{label:"部门名称",prop:"deptName"},{default:i(()=>[s(y,{modelValue:t.deptDialog.form.deptName,"onUpdate:modelValue":e[8]||(e[8]=n=>t.deptDialog.form.deptName=n),placeholder:"请输入部门名称",size:"medium"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),s(V,{gutter:20},{default:i(()=>[s(D,{span:12},{default:i(()=>[s(h,{label:"电话"},{default:i(()=>[s(y,{modelValue:t.deptDialog.form.phone,"onUpdate:modelValue":e[9]||(e[9]=n=>t.deptDialog.form.phone=n),placeholder:"请输入联系电话",size:"medium"},null,8,["modelValue"])]),_:1})]),_:1}),s(D,{span:12},{default:i(()=>[s(h,{label:"邮箱"},{default:i(()=>[s(y,{modelValue:t.deptDialog.form.email,"onUpdate:modelValue":e[10]||(e[10]=n=>t.deptDialog.form.email=n),placeholder:"请输入邮箱",size:"medium"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),s(V,{gutter:20},{default:i(()=>[s(D,{span:24},{default:i(()=>[s(h,{label:"地址"},{default:i(()=>[s(y,{modelValue:t.deptDialog.form.address,"onUpdate:modelValue":e[11]||(e[11]=n=>t.deptDialog.form.address=n),placeholder:"请输入部门地址",size:"medium"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),s(V,{gutter:20},{default:i(()=>[s(D,{span:12},{default:i(()=>[s(h,{label:"状态",prop:"status"},{default:i(()=>[s(B,{modelValue:t.deptDialog.form.status,"onUpdate:modelValue":e[12]||(e[12]=n=>t.deptDialog.form.status=n)},{default:i(()=>[s(L,{label:1},{default:i(()=>e[47]||(e[47]=[o("正常")])),_:1,__:[47]}),s(L,{label:0},{default:i(()=>e[48]||(e[48]=[o("停用")])),_:1,__:[48]})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),s(h,{label:"描述"},{default:i(()=>[s(y,{type:"textarea",rows:3,modelValue:t.deptDialog.form.remark,"onUpdate:modelValue":e[13]||(e[13]=n=>t.deptDialog.form.remark=n),placeholder:"请输入部门描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}const Je=q(O,[["render",je],["__scopeId","data-v-061ac746"]]);export{Je as default};
