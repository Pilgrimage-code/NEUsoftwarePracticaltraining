import{_ as F,c as p,b as t,t as l,A as y,z as C,p as _,F as j,d as U,u as O,a as x,r as q,D as G,o as H,E as N,j as J,k as c,f,C as K,m as b}from"./index-Ntw4s37F.js";import{a as Q,b as W}from"./learning-C_xxH9mD.js";import{c as X}from"./course-DBRud_bH.js";const Y={name:"LearningRecords",setup(){const u=J(),s=O(),I=x(!1),o=x(""),n=x([]),k=q({totalCourses:0,completedCourses:0,totalStudyTime:0,averageProgress:0}),L=G(()=>o.value.trim()?n.value.filter(e=>{var r,i;return((r=e.courseName)==null?void 0:r.toLowerCase().includes(o.value.toLowerCase()))||((i=e.instructor)==null?void 0:i.toLowerCase().includes(o.value.toLowerCase()))}):n.value),D=async()=>{var e;try{I.value=!0;const r=s.userId;if(console.log("当前用户ID:",r),!r){N.warning("请先登录"),n.value=[];return}const i=await Q({userId:r,current:1,size:100});if(console.log("学习记录API返回:",i),i.code===200){if(n.value=((e=i.data)==null?void 0:e.records)||i.data||[],console.log("获取到学习记录:",n.value.length),n.value.length>0){for(const d of n.value)if(!d.courseName&&d.courseId)try{const v=await X.getCourseById(d.courseId);v.code===200&&(d.courseName=v.data.courseName,d.courseImage=v.data.coverImage,d.instructor=v.data.instructor)}catch(v){console.warn(`无法获取课程信息(ID=${d.courseId}):`,v)}}}else console.warn("获取学习记录失败:",i.message),N.warning(`获取学习记录失败: ${i.message||"未知错误"}`),n.value=[]}catch(r){console.error("获取学习记录失败:",r),N.warning("获取学习记录失败，请稍后重试"),n.value=[]}finally{I.value=!1}},g=async()=>{try{const e=s.getUserId,r=await W(e);r.code===200?Object.assign(k,r.data):w()}catch(e){console.error("获取学习统计失败:",e),w()}},w=()=>{const e=n.value.length,r=n.value.filter(h=>(h.progress||0)>=100).length,i=n.value.reduce((h,S)=>h+(S.studyDuration||0),0),d=Math.round(i/60*10)/10,v=e>0?Math.round(n.value.reduce((h,S)=>h+(S.progress||0),0)/e):0;Object.assign(k,{totalCourses:e,completedCourses:r,totalStudyTime:d,averageProgress:v})},T=e=>e?new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"暂无",a=e=>{if(!e)return"0小时";const r=Math.floor(e/60),i=e%60;return`${r}小时${i}分钟`},m=e=>e>=100?"#67C23A":e>=60?"#409EFF":"#E6A23C",E=e=>{switch(e){case 0:return"info";case 1:return"primary";case 2:return"success";case 3:return"warning";default:return"info"}},R=e=>{switch(e){case 0:return"未开始";case 1:return"学习中";case 2:return"已完成";case 3:return"已暂停";default:return"未知"}},M=e=>{e.target.src="/default-course.png"},V=e=>{u.push(`/dashboard/course-detail/${e.courseId}?action=start`)},P=e=>{e.lastChapterId?u.push(`/dashboard/course-detail/${e.courseId}?chapterId=${e.lastChapterId}&action=resume`):u.push(`/dashboard/course-detail/${e.courseId}?action=start`)},A=e=>{u.push(`/dashboard/course-detail/${e.courseId}`)},B=e=>{u.push({name:"LearningDetail",params:{courseId:e.courseId},query:{recordId:e.id}})},z=()=>{u.push("/dashboard/course-management")};return H(()=>{D(),g()}),{loading:I,searchText:o,records:n,stats:k,filteredRecords:L,formatDate:T,formatDuration:a,getProgressColor:m,getStatusType:E,getStatusText:R,handleImageError:M,startLearning:V,continueLearning:P,viewCourse:A,viewDetails:B,goToCourses:z}}},Z={class:"learning-records"},$={class:"stats-cards"},ss={class:"stats-card"},ts={class:"stats-content"},es={class:"stats-number"},os={class:"stats-card"},as={class:"stats-content"},ns={class:"stats-number"},rs={class:"stats-card"},is={class:"stats-content"},ls={class:"stats-number"},cs={class:"stats-card"},ds={class:"stats-content"},us={class:"stats-number"},gs={class:"records-section"},ms={class:"section-header"},vs={class:"search-bar"},ps={key:0,class:"loading-wrapper"},_s={key:1,class:"empty-state"},fs={key:2,class:"records-list"},ys={class:"record-info"},hs={class:"course-cover"},Cs=["src","alt"],Is={class:"course-details"},ks={class:"instructor"},ws={class:"enrollment-time"},bs={class:"progress-section"},Ls={class:"progress-info"},Ds={class:"progress-percentage"},Ts={class:"progress-details"},Ss={key:0},xs={class:"actions"};function Ns(u,s,I,o,n,k){const L=C("el-input"),D=C("el-loading"),g=C("el-button"),w=C("el-tag"),T=C("el-progress");return c(),p("div",Z,[s[21]||(s[21]=t("div",{class:"page-header"},[t("h2",null,"学习记录"),t("p",null,"查看您的学习进度和成果")],-1)),t("div",$,[t("div",ss,[s[3]||(s[3]=t("div",{class:"stats-icon"},"📚",-1)),t("div",ts,[t("div",es,l(o.stats.totalCourses||0),1),s[2]||(s[2]=t("div",{class:"stats-label"},"已学课程",-1))])]),t("div",os,[s[5]||(s[5]=t("div",{class:"stats-icon"},"✅",-1)),t("div",as,[t("div",ns,l(o.stats.completedCourses||0),1),s[4]||(s[4]=t("div",{class:"stats-label"},"已完成",-1))])]),t("div",rs,[s[7]||(s[7]=t("div",{class:"stats-icon"},"⏱️",-1)),t("div",is,[t("div",ls,l(o.stats.totalStudyTime||1),1),s[6]||(s[6]=t("div",{class:"stats-label"},"学习时长(小时)",-1))])]),t("div",cs,[s[9]||(s[9]=t("div",{class:"stats-icon"},"🎯",-1)),t("div",ds,[t("div",us,l(o.stats.averageProgress||50)+"%",1),s[8]||(s[8]=t("div",{class:"stats-label"},"平均进度",-1))])])]),t("div",gs,[t("div",ms,[s[10]||(s[10]=t("h3",null,"学习记录",-1)),t("div",vs,[y(L,{modelValue:o.searchText,"onUpdate:modelValue":s[0]||(s[0]=a=>o.searchText=a),placeholder:"搜索课程...","prefix-icon":"el-icon-search",onInput:u.handleSearch},null,8,["modelValue","onInput"])])]),o.loading?(c(),p("div",ps,[y(D,{text:"加载中..."})])):o.records.length===0?(c(),p("div",_s,[s[12]||(s[12]=t("div",{class:"empty-icon"},"📖",-1)),s[13]||(s[13]=t("h3",null,"暂无学习记录",-1)),s[14]||(s[14]=t("p",null,"开始学习您的第一门课程吧！",-1)),y(g,{type:"primary",onClick:o.goToCourses},{default:_(()=>s[11]||(s[11]=[f("浏览课程")])),_:1,__:[11]},8,["onClick"])])):(c(),p("div",fs,[(c(!0),p(j,null,U(o.filteredRecords,a=>(c(),p("div",{key:a.id,class:"record-card"},[t("div",ys,[t("div",hs,[t("img",{src:a.courseImage,alt:a.courseName,onError:s[1]||(s[1]=(...m)=>o.handleImageError&&o.handleImageError(...m))},null,40,Cs)]),t("div",Is,[t("h4",null,l(a.courseName||"未知课程"),1),t("p",ks,"讲师："+l(a.instructor||"未知讲师"),1),t("p",ws,"报名时间："+l(o.formatDate(a.enrollmentTime)),1)])]),t("div",bs,[t("div",Ls,[s[15]||(s[15]=t("span",{class:"progress-text"},"学习进度",-1)),t("span",Ds,l(a.progress||0)+"%",1),y(w,{type:o.getStatusType(a.status),size:"small",class:"status-tag"},{default:_(()=>[f(l(o.getStatusText(a.status)),1)]),_:2},1032,["type"])]),y(T,{percentage:a.progress||0,color:o.getProgressColor(a.progress||0)},null,8,["percentage","color"]),t("div",Ts,[t("span",null,"学习时长："+l(o.formatDuration(a.studyDuration||0)),1),a.completionTime?(c(),p("span",Ss," 完成时间："+l(o.formatDate(a.completionTime)),1)):K("",!0)])]),t("div",xs,[a.status===0?(c(),b(g,{key:0,type:"primary",onClick:m=>o.startLearning(a)},{default:_(()=>s[16]||(s[16]=[f(" 开始学习 ")])),_:2,__:[16]},1032,["onClick"])):a.status===1?(c(),b(g,{key:1,type:"primary",onClick:m=>o.continueLearning(a)},{default:_(()=>s[17]||(s[17]=[f(" 继续学习 ")])),_:2,__:[17]},1032,["onClick"])):a.status===2?(c(),b(g,{key:2,type:"success",onClick:m=>o.viewCourse(a)},{default:_(()=>s[18]||(s[18]=[f(" 已完成 ")])),_:2,__:[18]},1032,["onClick"])):(c(),b(g,{key:3,type:"warning",onClick:m=>o.continueLearning(a)},{default:_(()=>s[19]||(s[19]=[f(" 继续学习 ")])),_:2,__:[19]},1032,["onClick"])),y(g,{type:"text",onClick:m=>o.viewDetails(a)},{default:_(()=>s[20]||(s[20]=[f(" 查看详情 ")])),_:2,__:[20]},1032,["onClick"])])]))),128))]))])])}const Vs=F(Y,[["render",Ns],["__scopeId","data-v-d1b53453"]]);export{Vs as default};
