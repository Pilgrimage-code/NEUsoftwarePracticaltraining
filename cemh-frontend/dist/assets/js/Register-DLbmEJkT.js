import{_ as A,a as v,r as E,o as F,l as B,m as I,p as t,q as P,E as p,s as R,x as D,y as z,z as m,k as g,A as l,c as k,F as q,d as x,b as N,f as T,B as L,C as K}from"./index-Ntw4s37F.js";const M={name:"UserRegisterForm",setup(){const b=v(null),a=E({tenantId:"",deptId:"",username:"",nickname:"",password:"",phone:"",email:"",avatar:"",captcha:"",captchaKey:""}),w={tenantId:[{required:!0,message:"请选择企业",trigger:"change"}],deptId:[{required:!0,message:"请选择部门",trigger:"change"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"}],nickname:[{required:!0,message:"请输入昵称",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码至少6位",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"手机号格式不正确",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱",trigger:"blur"}],avatar:[{required:!0,message:"请上传头像",trigger:"change"}],captcha:[{required:!0,message:"请输入验证码",trigger:"blur"}]},e=v([]),h=v([]),V=v(!1),u=v(""),n="http://localhost:8080/api/upload/image",d={Authorization:"Bearer "+(localStorage.getItem("token")||"")},s=async()=>{try{const r=await P();r.code===200&&(e.value=r.data.map(i=>({value:i.id,label:i.tenantName})))}catch{p.error("获取企业列表失败")}},f=async r=>{if(a.deptId="",!r){h.value=[];return}try{const i=await z(r);i.code===200&&(h.value=i.data.map(U=>({value:U.id,label:U.deptName})))}catch{p.error("获取部门列表失败")}},_=async()=>{const r=await R();r.code===200&&(u.value=r.data.img,a.captchaKey=r.data.key)},c=r=>{r.code===200?(a.avatar=r.data.url,p.success("头像上传成功")):p.error(r.message||"头像上传失败")},y=()=>{p.error("头像上传失败")},C=r=>{const i=r.type==="image/jpeg"||r.type==="image/png",U=r.size/1024/1024<2;return i||p.error("上传头像图片只能是 JPG/PNG 格式!"),U||p.error("上传头像图片大小不能超过 2MB!"),i&&U},o=()=>{b.value.validate(async r=>{if(r){V.value=!0;try{const i=await D({...a});i.code===200?(p.success("注册成功，请登录"),window.location.href="/login"):(p.error(i.message||"注册失败"),_())}catch{p.error("注册异常"),_()}finally{V.value=!1}}})};return F(()=>{s(),_()}),B(()=>a.tenantId,r=>{f(r)}),{formRef:b,form:a,rules:w,tenantList:e,deptList:h,loading:V,captchaImg:u,fetchDepts:f,refreshCaptcha:_,handleAvatarSuccess:c,beforeAvatarUpload:C,submitForm:o,uploadAction:n,uploadHeaders:d,handleAvatarError:y}}},G=["src"],S={key:1,class:"avatar-uploader-placeholder"},H=["src"];function J(b,a,w,e,h,V){const u=m("el-option"),n=m("el-select"),d=m("el-form-item"),s=m("el-input"),f=m("el-upload"),_=m("el-col"),c=m("el-row"),y=m("el-button"),C=m("el-form");return g(),I(C,{ref:"formRef",model:e.form,rules:e.rules,"label-width":"90px",class:"register-form"},{default:t(()=>[l(d,{label:"所属企业",prop:"tenantId"},{default:t(()=>[l(n,{modelValue:e.form.tenantId,"onUpdate:modelValue":a[0]||(a[0]=o=>e.form.tenantId=o),placeholder:"请选择企业",filterable:"",onChange:e.fetchDepts},{default:t(()=>[(g(!0),k(q,null,x(e.tenantList,o=>(g(),I(u,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),l(d,{label:"所属部门",prop:"deptId"},{default:t(()=>[l(n,{modelValue:e.form.deptId,"onUpdate:modelValue":a[1]||(a[1]=o=>e.form.deptId=o),placeholder:"请选择部门",filterable:"",disabled:!e.form.tenantId},{default:t(()=>[(g(!0),k(q,null,x(e.deptList,o=>(g(),I(u,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(d,{label:"用户名",prop:"username"},{default:t(()=>[l(s,{modelValue:e.form.username,"onUpdate:modelValue":a[2]||(a[2]=o=>e.form.username=o),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(d,{label:"昵称",prop:"nickname"},{default:t(()=>[l(s,{modelValue:e.form.nickname,"onUpdate:modelValue":a[3]||(a[3]=o=>e.form.nickname=o),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),l(d,{label:"密码",prop:"password"},{default:t(()=>[l(s,{modelValue:e.form.password,"onUpdate:modelValue":a[4]||(a[4]=o=>e.form.password=o),type:"password","show-password":"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),l(d,{label:"手机号",prop:"phone"},{default:t(()=>[l(s,{modelValue:e.form.phone,"onUpdate:modelValue":a[5]||(a[5]=o=>e.form.phone=o),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),l(d,{label:"邮箱",prop:"email"},{default:t(()=>[l(s,{modelValue:e.form.email,"onUpdate:modelValue":a[6]||(a[6]=o=>e.form.email=o),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),l(d,{label:"头像",prop:"avatar"},{default:t(()=>[l(f,{class:"avatar-uploader",action:e.uploadAction,headers:e.uploadHeaders,"show-file-list":!1,"before-upload":e.beforeAvatarUpload,"on-success":e.handleAvatarSuccess,"on-error":e.handleAvatarError,accept:"image/*"},{default:t(()=>[e.form.avatar?(g(),k("img",{key:0,src:e.form.avatar,class:"avatar"},null,8,G)):(g(),k("div",S,a[9]||(a[9]=[N("i",{class:"el-icon-plus avatar-uploader-icon"},null,-1),N("span",{style:{color:"#bbb","font-size":"12px"}},"点击上传",-1)])))]),_:1},8,["action","headers","before-upload","on-success","on-error"])]),_:1}),l(d,{label:"验证码",prop:"captcha"},{default:t(()=>[l(c,{gutter:"10"},{default:t(()=>[l(_,{span:14},{default:t(()=>[l(s,{modelValue:e.form.captcha,"onUpdate:modelValue":a[7]||(a[7]=o=>e.form.captcha=o),maxlength:"6",placeholder:"请输入验证码"},null,8,["modelValue"])]),_:1}),l(_,{span:10},{default:t(()=>[N("img",{src:e.captchaImg,onClick:a[8]||(a[8]=(...o)=>e.refreshCaptcha&&e.refreshCaptcha(...o)),class:"captcha-img",title:"点击刷新"},null,8,H)]),_:1})]),_:1})]),_:1}),l(d,null,{default:t(()=>[l(y,{type:"primary",onClick:e.submitForm,loading:e.loading},{default:t(()=>a[10]||(a[10]=[T("注册")])),_:1,__:[10]},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules"])}const j=A(M,[["render",J],["__scopeId","data-v-4235a30f"]]),O={name:"TenantRegisterForm",setup(){const b=v(null),a=E({tenantCode:"",tenantName:"",contactName:"",contactPhone:"",contactEmail:"",departments:[""],captcha:"",captchaKey:""}),w={tenantCode:[{required:!0,message:"请输入租户代码",trigger:"blur"}],tenantName:[{required:!0,message:"请输入企业名称",trigger:"blur"}],contactName:[{required:!0,message:"请输入联系人",trigger:"blur"}],contactPhone:[{required:!0,message:"请输入联系电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"手机号格式不正确",trigger:"blur"}],contactEmail:[{type:"email",message:"请输入正确的邮箱",trigger:"blur"}],departments:[{required:!0,type:"array",min:1,message:"请至少填写一个部门",trigger:"change"}],captcha:[{required:!0,message:"请输入验证码",trigger:"blur"}]},e=v(!1),h=v(""),V=()=>{a.departments.push("")},u=s=>{a.departments.splice(s,1)},n=async()=>{const s=await R();s.code===200&&(h.value=s.data.img,a.captchaKey=s.data.key)},d=()=>{b.value.validate(async s=>{if(s){e.value=!0;try{const f=await L({...a});f.code===200?(p.success("企业注册成功，请登录"),window.location.href="/login"):(p.error(f.message||"注册失败"),n())}catch{p.error("注册异常"),n()}finally{e.value=!1}}})};return F(()=>{n()}),{formRef:b,form:a,rules:w,loading:e,captchaImg:h,addDept:V,removeDept:u,refreshCaptcha:n,submitForm:d}}},Q=["src"];function W(b,a,w,e,h,V){const u=m("el-input"),n=m("el-form-item"),d=m("el-button"),s=m("el-col"),f=m("el-row"),_=m("el-form");return g(),I(_,{ref:"formRef",model:e.form,rules:e.rules,"label-width":"90px",class:"register-form"},{default:t(()=>[l(n,{label:"租户代码",prop:"tenantCode"},{default:t(()=>[l(u,{modelValue:e.form.tenantCode,"onUpdate:modelValue":a[0]||(a[0]=c=>e.form.tenantCode=c),placeholder:"请输入租户代码"},null,8,["modelValue"])]),_:1}),l(n,{label:"企业名称",prop:"tenantName"},{default:t(()=>[l(u,{modelValue:e.form.tenantName,"onUpdate:modelValue":a[1]||(a[1]=c=>e.form.tenantName=c),placeholder:"请输入企业名称"},null,8,["modelValue"])]),_:1}),l(n,{label:"联系人",prop:"contactName"},{default:t(()=>[l(u,{modelValue:e.form.contactName,"onUpdate:modelValue":a[2]||(a[2]=c=>e.form.contactName=c),placeholder:"请输入联系人姓名"},null,8,["modelValue"])]),_:1}),l(n,{label:"联系电话",prop:"contactPhone"},{default:t(()=>[l(u,{modelValue:e.form.contactPhone,"onUpdate:modelValue":a[3]||(a[3]=c=>e.form.contactPhone=c),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),l(n,{label:"联系邮箱",prop:"contactEmail"},{default:t(()=>[l(u,{modelValue:e.form.contactEmail,"onUpdate:modelValue":a[4]||(a[4]=c=>e.form.contactEmail=c),placeholder:"请输入联系邮箱"},null,8,["modelValue"])]),_:1}),l(n,{label:"部门列表",prop:"departments"},{default:t(()=>[(g(!0),k(q,null,x(e.form.departments,(c,y)=>(g(),k("div",{key:y,class:"dept-item"},[l(u,{modelValue:e.form.departments[y],"onUpdate:modelValue":C=>e.form.departments[y]=C,placeholder:"请输入部门名称",style:{width:"80%"}},null,8,["modelValue","onUpdate:modelValue"]),e.form.departments.length>1?(g(),I(d,{key:0,icon:"el-icon-delete",onClick:C=>e.removeDept(y),circle:"",type:"danger",size:"small"},null,8,["onClick"])):K("",!0)]))),128)),l(d,{type:"primary",icon:"el-icon-plus",onClick:e.addDept,size:"small",style:{"margin-top":"8px"}},{default:t(()=>a[7]||(a[7]=[T("添加部门")])),_:1,__:[7]},8,["onClick"])]),_:1}),l(n,{label:"验证码",prop:"captcha"},{default:t(()=>[l(f,{gutter:"10"},{default:t(()=>[l(s,{span:14},{default:t(()=>[l(u,{modelValue:e.form.captcha,"onUpdate:modelValue":a[5]||(a[5]=c=>e.form.captcha=c),maxlength:"6",placeholder:"请输入验证码"},null,8,["modelValue"])]),_:1}),l(s,{span:10},{default:t(()=>[N("img",{src:e.captchaImg,onClick:a[6]||(a[6]=(...c)=>e.refreshCaptcha&&e.refreshCaptcha(...c)),class:"captcha-img",title:"点击刷新"},null,8,Q)]),_:1})]),_:1})]),_:1}),l(n,null,{default:t(()=>[l(d,{type:"primary",onClick:e.submitForm,loading:e.loading},{default:t(()=>a[8]||(a[8]=[T("注册")])),_:1,__:[8]},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules"])}const X=A(O,[["render",W],["__scopeId","data-v-1b1d81ee"]]),Y={name:"Register",components:{UserRegisterForm:j,TenantRegisterForm:X},setup(){return{activeTab:v("user")}}},Z={class:"register-page"};function $(b,a,w,e,h,V){const u=m("user-register-form"),n=m("el-tab-pane"),d=m("tenant-register-form"),s=m("el-tabs"),f=m("el-card");return g(),k("div",Z,[l(f,{class:"register-card"},{default:t(()=>[l(s,{modelValue:e.activeTab,"onUpdate:modelValue":a[0]||(a[0]=_=>e.activeTab=_),stretch:""},{default:t(()=>[l(n,{label:"用户注册",name:"user"},{default:t(()=>[l(u)]),_:1}),l(n,{label:"企业注册",name:"tenant"},{default:t(()=>[l(d)]),_:1})]),_:1},8,["modelValue"])]),_:1})])}const ae=A(Y,[["render",$],["__scopeId","data-v-9defb0d0"]]);export{ae as default};
