import{_ as A,c as N,b as c,f as T,t as C,A as e,p as a,z as m,a as M,D as B,G,r as z,o as j,E as p,j as J,k as S,m as L}from"./index-Ntw4s37F.js";import{m as P}from"./meeting-Yn1Lkn_b.js";const O={name:"MeetingForm",setup(){const f=G(),t=J(),D=M(null),l=M(!1),E=M("basic"),_=B(()=>f.name==="MeetingEdit"),r=z({title:"",description:"",type:"",status:"",startTime:"",endTime:"",location:"",maxParticipants:0,registrationDeadline:"",requiresApproval:!1,fee:0,requirements:"",tags:"",materials:[],coverImage:"",remark:"",isTop:0}),s={title:[{required:!0,message:"请输入会议标题",trigger:"blur"}],description:[{required:!0,message:"请输入会议描述",trigger:"blur"}],type:[{required:!0,message:"请选择会议类型",trigger:"change"}],startTime:[{required:!0,message:"请选择开始时间",trigger:"change"}],endTime:[{required:!0,message:"请选择结束时间",trigger:"change"}],location:[{required:!0,message:"请输入会议地点",trigger:"blur"}]},d=async i=>{try{console.log("开始获取会议详情，ID:",i);const u=await P.getMeetingDetail(i);if(console.log("后端返回的数据:",u),!u){console.error("后端返回的数据为空"),p.error("获取会议详情失败，返回数据为空");return}const n=u.data,F=y=>{if(!y)return"";console.log("原始时间字符串:",y);let k=y.replace(/(\d{4})-(\d{1,2})-(\d{1})(?=T|$)/,(R,U,h,q)=>`${U}-${h.padStart(2,"0")}-${q.padStart(2,"0")}`).replace(/([+-])(\d{2})(\d{2})?$/,(R,U,h,q="00")=>`${U}${h}:${q}`);const o=new Date(k);return isNaN(o.getTime())?"":o};r.title=n.title||"",r.description=n.description||"",r.type=String(n.type)||"",r.status=String(n.status)||"",r.startTime=F(n.startTime)||"",r.endTime=F(n.endTime)||"",r.location=n.location||"",r.maxParticipants=Number(n.maxParticipants)||0,r.registrationDeadline=F(n.registrationDeadline)||"",r.requiresApproval=!!n.requiresApproval||!1,r.fee=Number(n.fee)||0,r.requirements=n.requirements||"",r.tags=n.tags||"",r.materials=n.materials||[],r.coverImage=n.coverImage||"",r.remark=n.remark||"",console.log("赋值后的表单数据:",r)}catch(u){console.log("获取会议详情出错:",u),p.error("获取会议详情失败")}},b=(i,u,n)=>{r.materials=n,p.success("文件上传成功")},g=(i,u)=>{r.materials=u},w=i=>{i.code===200?(r.coverImage=i.data.url,p.success("封面上传成功")):p.error("封面上传失败")},v=i=>{const u=i.type==="image/jpeg"||i.type==="image/png",n=i.size/1024/1024<2;return u||p.error("上传封面只能是 JPG/PNG 格式!"),n||p.error("上传封面大小不能超过 2MB!"),u&&n},V=async()=>{try{await D.value.validate(),l.value=!0;let i;_.value?(r.id=f.params.id,i=await P.updateMeeting(r)):i=await P.createMeeting(r),i.code===200?(p.success(_.value?"会议更新成功":"会议创建成功"),t.push("/dashboard/meetings")):p.error(i.msg)}catch(i){console.error("操作出错:",i),i!==!1&&p.error("操作失败")}finally{l.value=!1}},x=()=>{t.go(-1)};return j(()=>{_.value&&f.params.id&&d(f.params.id)}),{meetingFormRef:D,saving:l,activeTab:E,isEdit:_,meetingForm:r,meetingFormRules:s,handleFileSuccess:b,handleFileRemove:g,handleCoverSuccess:w,beforeCoverUpload:v,handleSubmit:V,handleCancel:x}}},H={class:"meeting-form"},K={class:"page-header"},Q={class:"header-content"},W={class:"page-title"},X={class:"page-description"},Y={class:"form-section"},Z=["src"],$={class:"form-actions"};function ee(f,t,D,l,E,_){const r=m("el-input"),s=m("el-form-item"),d=m("el-option"),b=m("el-select"),g=m("el-col"),w=m("el-row"),v=m("el-date-picker"),V=m("el-tab-pane"),x=m("el-input-number"),i=m("el-switch"),u=m("el-button"),n=m("el-upload"),F=m("el-icon"),y=m("el-tabs"),I=m("el-form"),k=m("el-card");return S(),N("div",H,[c("div",K,[c("div",Q,[c("h1",W,[t[15]||(t[15]=c("i",{class:"el-icon-date"},null,-1)),T(" "+C(l.isEdit?"编辑会议":"创建会议"),1)]),c("p",X,C(l.isEdit?"修改会议信息和设置":"创建新的会议活动"),1)])]),c("div",Y,[e(k,{class:"form-card"},{default:a(()=>[e(I,{ref:"meetingFormRef",model:l.meetingForm,rules:l.meetingFormRules,"label-width":"120px",class:"meeting-form-content"},{default:a(()=>[e(y,{modelValue:l.activeTab,"onUpdate:modelValue":t[14]||(t[14]=o=>l.activeTab=o)},{default:a(()=>[e(V,{label:"基本信息",name:"basic"},{default:a(()=>[e(s,{label:"会议标题",prop:"title"},{default:a(()=>[e(r,{modelValue:l.meetingForm.title,"onUpdate:modelValue":t[0]||(t[0]=o=>l.meetingForm.title=o),placeholder:"请输入会议标题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(s,{label:"会议描述",prop:"description"},{default:a(()=>[e(r,{modelValue:l.meetingForm.description,"onUpdate:modelValue":t[1]||(t[1]=o=>l.meetingForm.description=o),type:"textarea",rows:4,placeholder:"请输入会议描述",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(w,{gutter:20},{default:a(()=>[e(g,{span:12},{default:a(()=>[e(s,{label:"会议类型",prop:"type"},{default:a(()=>[e(b,{modelValue:l.meetingForm.type,"onUpdate:modelValue":t[2]||(t[2]=o=>l.meetingForm.type=o),placeholder:"请选择会议类型",style:{width:"100%"}},{default:a(()=>[e(d,{label:"线上会议",value:"1"}),e(d,{label:"线下会议",value:"2"}),e(d,{label:"混合会议",value:"3"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(g,{span:12},{default:a(()=>[e(s,{label:"会议状态",prop:"status"},{default:a(()=>[e(b,{modelValue:l.meetingForm.status,"onUpdate:modelValue":t[3]||(t[3]=o=>l.meetingForm.status=o),placeholder:"请选择会议状态",style:{width:"100%"}},{default:a(()=>[e(d,{label:"草稿",value:"0"}),e(d,{label:"已发布",value:"1"}),e(d,{label:"进行中",value:"2"}),e(d,{label:"已结束",value:"3"}),e(d,{label:"已取消",value:"4"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(w,{gutter:20},{default:a(()=>[e(g,{span:12},{default:a(()=>[e(s,{label:"开始时间",prop:"startTime"},{default:a(()=>[e(v,{modelValue:l.meetingForm.startTime,"onUpdate:modelValue":t[4]||(t[4]=o=>l.meetingForm.startTime=o),type:"datetime",placeholder:"请选择开始时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(g,{span:12},{default:a(()=>[e(s,{label:"结束时间",prop:"endTime"},{default:a(()=>[e(v,{modelValue:l.meetingForm.endTime,"onUpdate:modelValue":t[5]||(t[5]=o=>l.meetingForm.endTime=o),type:"datetime",placeholder:"请选择结束时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(s,{label:"会议地点",prop:"location"},{default:a(()=>[e(r,{modelValue:l.meetingForm.location,"onUpdate:modelValue":t[6]||(t[6]=o=>l.meetingForm.location=o),placeholder:"请输入会议地点或线上会议链接"},null,8,["modelValue"])]),_:1})]),_:1}),e(V,{label:"参会设置",name:"participants"},{default:a(()=>[e(s,{label:"参会人数限制"},{default:a(()=>[e(x,{modelValue:l.meetingForm.maxParticipants,"onUpdate:modelValue":t[7]||(t[7]=o=>l.meetingForm.maxParticipants=o),min:1,max:1e3,placeholder:"不限制",style:{width:"200px"}},null,8,["modelValue"]),t[16]||(t[16]=c("span",{style:{"margin-left":"8px",color:"#909399"}},"人（0表示不限制）",-1))]),_:1,__:[16]}),e(s,{label:"报名截止时间"},{default:a(()=>[e(v,{modelValue:l.meetingForm.registrationDeadline,"onUpdate:modelValue":t[8]||(t[8]=o=>l.meetingForm.registrationDeadline=o),type:"datetime",placeholder:"请选择报名截止时间",style:{width:"300px"}},null,8,["modelValue"])]),_:1}),e(s,{label:"是否需要审核"},{default:a(()=>[e(i,{modelValue:l.meetingForm.requiresApproval,"onUpdate:modelValue":t[9]||(t[9]=o=>l.meetingForm.requiresApproval=o)},null,8,["modelValue"]),t[17]||(t[17]=c("span",{style:{"margin-left":"8px",color:"#909399"}},"开启后需要管理员审核才能参会",-1))]),_:1,__:[17]}),e(s,{label:"参会费用"},{default:a(()=>[e(x,{modelValue:l.meetingForm.fee,"onUpdate:modelValue":t[10]||(t[10]=o=>l.meetingForm.fee=o),min:0,precision:2,placeholder:"免费",style:{width:"200px"}},null,8,["modelValue"]),t[18]||(t[18]=c("span",{style:{"margin-left":"8px",color:"#909399"}},"元（0表示免费）",-1))]),_:1,__:[18]}),e(s,{label:"参会要求"},{default:a(()=>[e(r,{modelValue:l.meetingForm.requirements,"onUpdate:modelValue":t[11]||(t[11]=o=>l.meetingForm.requirements=o),type:"textarea",rows:3,placeholder:"请输入参会要求，如需要携带的物品、技能要求等"},null,8,["modelValue"])]),_:1})]),_:1}),e(V,{label:"其他设置",name:"settings"},{default:a(()=>[e(s,{label:"会议标签"},{default:a(()=>[e(b,{modelValue:l.meetingForm.tags,"onUpdate:modelValue":t[12]||(t[12]=o=>l.meetingForm.tags=o),filterable:"","allow-create":"",placeholder:"请选择或输入会议标签",style:{width:"100%"}},{default:a(()=>[e(d,{label:"技术分享",value:"tech"}),e(d,{label:"产品讨论",value:"product"}),e(d,{label:"项目评审",value:"review"}),e(d,{label:"培训学习",value:"training"}),e(d,{label:"团队建设",value:"team"})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"会议材料"},{default:a(()=>[e(n,{class:"upload-demo",action:"/api/api/upload/document","file-list":l.meetingForm.materials,"on-success":l.handleFileSuccess,"on-remove":l.handleFileRemove,multiple:""},{tip:a(()=>t[20]||(t[20]=[c("div",{class:"el-upload__tip"}," 支持上传PDF、DOC、PPT等格式文件，单个文件不超过10MB ",-1)])),default:a(()=>[e(u,{size:"small",type:"primary"},{default:a(()=>t[19]||(t[19]=[c("i",{class:"el-icon-upload"},null,-1),T(" 上传文件 ")])),_:1,__:[19]})]),_:1},8,["file-list","on-success","on-remove"])]),_:1}),e(s,{label:"会议封面"},{default:a(()=>[e(n,{class:"cover-uploader",action:"/api/api/upload/image","show-file-list":!1,"on-success":l.handleCoverSuccess,"before-upload":l.beforeCoverUpload},{default:a(()=>[l.meetingForm.coverImage?(S(),N("img",{key:0,src:l.meetingForm.coverImage,class:"cover-image"},null,8,Z)):(S(),L(F,{key:1,class:"el-icon-plus cover-uploader-icon"}))]),_:1},8,["on-success","before-upload"])]),_:1}),e(s,{label:"备注信息"},{default:a(()=>[e(r,{modelValue:l.meetingForm.remark,"onUpdate:modelValue":t[13]||(t[13]=o=>l.meetingForm.remark=o),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),c("div",$,[e(u,{onClick:l.handleCancel},{default:a(()=>t[21]||(t[21]=[T("取消")])),_:1,__:[21]},8,["onClick"]),e(u,{type:"primary",onClick:l.handleSubmit,loading:l.saving},{default:a(()=>[T(C(l.isEdit?"更新会议":"发布会议"),1)]),_:1},8,["onClick","loading"])])]),_:1},8,["model","rules"])]),_:1})])])}const ae=A(O,[["render",ee],["__scopeId","data-v-3e07926a"]]);export{ae as default};
